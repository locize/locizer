!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).locizer=t()}(this,(function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t){var o=function(t,o){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,o||"default");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===o?String:Number)(t)}(t,"string");return"symbol"==e(o)?o:o+""}function o(e,o,n){return(o=t(o))in e?Object.defineProperty(e,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[o]=n,e}var n=[],i=n.forEach,r=n.slice;function s(e){return i.call(r.call(arguments,1),(function(t){if(t)for(var o in t)void 0===e[o]&&(e[o]=t[o])})),e}function a(e,t,o){function n(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}for(var i="string"!=typeof t?[].concat(t):t.split(".");i.length>1;){if(!e)return{};var r=n(i.shift());!e[r]&&o&&(e[r]=new o),e=e[r]}return e?{obj:e,k:n(i.shift())}:{}}function c(e,t,o){var n=a(e,t,Object);n.obj[n.k]=o}function u(e,t){var o=a(e,t),n=o.obj,i=o.k;if(n)return n[i]}var l=new RegExp("{{(.+?)}}","g");function f(e,t,o){var n,i,r;for(;n=l.exec(e);)"string"!=typeof(i=n[1].trim())&&(i=null==(r=i)?"":""+r),i||(i=""),i=i.replace(/\$/g,"$$$$"),e=e.replace(n[0],t[i]||i),l.lastIndex=0;return e}function d(e,t){return t.reduce((function(t,o){if(t)return t;if(!e||!e[o]||"string"!=typeof e[o]||!e[o].toLowerCase()===o.toLowerCase()){var n='i18next-locize-backend :: got "'.concat(e[o],'" in options for ').concat(o," which is invalid.");return console.warn(n),n}return!1}),!1)}function p(){var e,t,o=new Promise((function(o,n){e=o,t=n}));return o.resolve=e,o.reject=t,o}function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}var h,v,y="function"==typeof fetch?fetch:void 0;if("undefined"!=typeof global&&global.fetch?y=global.fetch:"undefined"!=typeof window&&window.fetch&&(y=window.fetch),"function"!=typeof XMLHttpRequest&&"object"!==("undefined"==typeof XMLHttpRequest?"undefined":g(XMLHttpRequest))||("undefined"!=typeof global&&global.XMLHttpRequest?h=global.XMLHttpRequest:"undefined"!=typeof window&&window.XMLHttpRequest&&(h=window.XMLHttpRequest)),"function"==typeof ActiveXObject&&("undefined"!=typeof global&&global.ActiveXObject?v=global.ActiveXObject:"undefined"!=typeof window&&window.ActiveXObject&&(v=window.ActiveXObject)),"function"!=typeof y&&(y=void 0),!y&&!h&&!v)try{Promise.resolve().then((function(){return ve})).then((function(e){y=e.default})).catch((function(){}))}catch(E){}var w=function(e,t,o,n){return"function"==typeof o&&(n=o,o=void 0),n=n||function(){},y?function(e,t,o,n){var i={};"undefined"==typeof window&&"undefined"!=typeof global&&void 0!==global.process&&global.process.versions&&global.process.versions.node&&(i["User-Agent"]="i18next-locize-backend (node/".concat(global.process.version,"; ").concat(global.process.platform," ").concat(global.process.arch,")")),e.authorize&&e.apiKey&&(i.Authorization=e.apiKey),(o||e.setContentTypeJSON)&&(i["Content-Type"]="application/json");var r=function(e){var t=e.headers&&"Error from cloudfront"===e.headers.get("x-cache");if(!e.ok)return n(e.statusText||"Error",{status:e.status,resourceNotExisting:t});e.text().then((function(o){n(null,{status:e.status,data:o,resourceNotExisting:t})})).catch(n)};"function"==typeof fetch?fetch(t,{method:o?"POST":"GET",body:o?JSON.stringify(o):void 0,headers:i}).then(r).catch(n):y(t,{method:o?"POST":"GET",body:o?JSON.stringify(o):void 0,headers:i}).then(r).catch(n)}(e,t,o,n):"function"==typeof XMLHttpRequest||"object"===("undefined"==typeof XMLHttpRequest?"undefined":g(XMLHttpRequest))||"function"==typeof ActiveXObject?function(e,t,o,n){try{var i=h?new h:new v("MSXML2.XMLHTTP.3.0");i.open(o?"POST":"GET",t,1),e.crossDomain||i.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.authorize&&e.apiKey&&i.setRequestHeader("Authorization",e.apiKey),(o||e.setContentTypeJSON)&&i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=function(){var e="Error from cloudfront"===i.getResponseHeader("x-cache");i.readyState>3&&n(i.status>=400?i.statusText:null,{status:i.status,data:i.responseText,resourceNotExisting:e})},i.send(JSON.stringify(o))}catch(e){console&&console.log(e)}}(e,t,o,n):void n(new Error("No fetch and no xhr implementation found!"))};function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function m(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,L(n.key),n)}}function L(e){var t=function(e,t){if("object"!=b(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,t||"default");if("object"!=b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==b(t)?t:t+""}var x;try{x="undefined"!=typeof window&&null!==window.localStorage;var k="notExistingLocizeProject";window.localStorage.setItem(k,"foo"),window.localStorage.removeItem(k)}catch(E){x=!1}var j=function(e,t,o){var n={};return t.authorize&&t.apiKey&&(n.Authorization=t.apiKey),(o||t.setContentTypeJSON)&&(n["Content-Type"]="application/json"),{method:o?"POST":"GET",url:e,headers:n,body:o}},O=function(e,t,o){if(1!==e.request.length)e.request(t,o);else try{var n=e.request(t);n&&"function"==typeof n.then?n.then((function(e){return o(null,e)})).catch(o):o(null,n)}catch(e){o(e)}};function S(e){var t=.25*e,o=Math.max(0,e-t),n=e+t;return Math.floor(o+Math.random()*(n-o))}var E,I,P,T=(E=function e(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.services=t,this.options=o,this.allOptions=n,this.type="backend",t&&t.projectId?this.init(null,t,n,o):this.init(t,o,n,i)},I=[{key:"init",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;!o.referenceLng&&n.fallbackLng&&Array.isArray(n.fallbackLng)&&"dev"!==n.fallbackLng[0]&&(o.referenceLng=n.fallbackLng[0]),this.services=e;var r,a,c,u={loadPath:"https://api.locize.app/{{projectId}}/{{version}}/{{lng}}/{{ns}}",privatePath:"https://api.locize.app/private/{{projectId}}/{{version}}/{{lng}}/{{ns}}",getLanguagesPath:"https://api.locize.app/languages/{{projectId}}",addPath:"https://api.locize.app/missing/{{projectId}}/{{version}}/{{lng}}/{{ns}}",updatePath:"https://api.locize.app/update/{{projectId}}/{{version}}/{{lng}}/{{ns}}",referenceLng:"en",crossDomain:!0,setContentTypeJSON:!1,version:"latest",private:!1,translatedPercentageThreshold:.9,failLoadingOnEmptyJSON:!1,allowedAddOrUpdateHosts:["localhost"],onSaved:!1,reloadInterval:"undefined"==typeof window&&36e5,checkForProjectTimeout:3e3,storageExpiration:36e5,writeDebounce:5e3},l=s(o,this.options||{});l.reloadInterval&&l.reloadInterval<3e5&&(console.warn("Your configured reloadInterval option is to low."),l.reloadInterval=u.reloadInterval),this.options=s(o,this.options||{},u),this.allOptions=n,this.somethingLoaded=!1,this.isProjectNotExisting=!1,this.storage=(r=this.options.storageExpiration,a=function(){},c=function(){},x?(a=function(e){window.localStorage.setItem("notExistingLocizeProject_".concat(e),Date.now())},c=function(e){var t=window.localStorage.getItem("notExistingLocizeProject_".concat(e));return!(!t||Date.now()-t>r&&(window.localStorage.removeItem("notExistingLocizeProject_".concat(e)),1))}):"undefined"!=typeof document&&(a=function(e){var t=new Date;t.setTime(t.getTime()+r);var o="; expires=".concat(t.toGMTString()),n="notExistingLocizeProject_".concat(e);try{document.cookie="".concat(n,"=").concat(Date.now()).concat(o,";path=/")}catch(e){}},c=function(e){var t="notExistingLocizeProject_".concat(e),o="".concat(t,"=");try{for(var n=document.cookie.split(";"),i=0;i<n.length;i++){for(var r=n[i];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(o))return!0}}catch(e){}return!1}),{setProjectNotExisting:a,isProjectNotExisting:c}),this.options.pull&&console.warn('The pull API was removed use "private: true" option instead: https://www.locize.com/docs/api#fetch-private-namespace-resources');var f,d,p,g,h="undefined"!=typeof window&&window.location&&window.location.hostname;h?(this.isAddOrUpdateAllowed="function"==typeof this.options.allowedAddOrUpdateHosts?this.options.allowedAddOrUpdateHosts(h):this.options.allowedAddOrUpdateHosts.indexOf(h)>-1,e&&e.logger&&(n.saveMissing||n.updateMissing)&&(this.isAddOrUpdateAllowed?"localhost"!==h&&e.logger.warn('locize-backend: you are using the save or update missings feature from this host "'.concat(h,'".\nMake sure you will not use it in production!\nhttps://www.locize.com/docs/going-to-production')):e.logger.warn("function"==typeof this.options.allowedAddOrUpdateHosts?'locize-backend: will not save or update missings because allowedAddOrUpdateHosts returned false for the host "'.concat(h,'".'):'locize-backend: will not save or update missings because the host "'.concat(h,'" was not in the list of allowedAddOrUpdateHosts: ').concat(this.options.allowedAddOrUpdateHosts.join(", ")," (matches need to be exact).")))):this.isAddOrUpdateAllowed=!0,"function"==typeof i&&this.getOptions((function(e,n,r){if(e)return i(e);t.options.referenceLng=o.referenceLng||n.referenceLng||t.options.referenceLng,i(null,n,r)})),this.queuedWrites={pending:{}},this.debouncedProcess=(f=this.process,d=this.options.writeDebounce,function(){var e=this,t=arguments,o=p&&!g;clearTimeout(g),g=setTimeout((function(){g=null,p||f.apply(e,t)}),d),o&&f.apply(e,t)}),this.interval&&clearInterval(this.interval),this.options.reloadInterval&&this.options.projectId&&(this.interval=setInterval((function(){return t.reload()}),this.options.reloadInterval),"object"===b(this.interval)&&"function"==typeof this.interval.unref&&this.interval.unref())}},{key:"reload",value:function(){var e=this,t=this.services||{logger:console},o=t.backendConnector,n=t.languageUtils,i=t.logger;if(o){var r=o.language;if(!r||"cimode"!==r.toLowerCase()){var s=[],a=function(e){n.toResolveHierarchy(e).forEach((function(e){s.indexOf(e)<0&&s.push(e)}))};a(r),this.allOptions.preload&&this.allOptions.preload.forEach((function(e){return a(e)})),s.forEach((function(t){e.allOptions.ns.forEach((function(e){o.read(t,e,"read",null,null,(function(n,r){n&&i.warn("loading namespace ".concat(e," for language ").concat(t," failed"),n),!n&&r&&i.log("loaded namespace ".concat(e," for language ").concat(t),r),o.loaded("".concat(t,"|").concat(e),n,r)}))}))}))}}}},{key:"getLanguages",value:function(e){var t,o=this;e||(t=p(),e=function(e,o){if(e)return t.reject(e);t.resolve(o)});var n=d(this.options,["projectId"]);if(n)return e(new Error(n)),t;var i=f(this.options.getLanguagesPath,{projectId:this.options.projectId});return!this.isProjectNotExisting&&this.storage.isProjectNotExisting(this.options.projectId)&&(this.isProjectNotExisting=!0),this.isProjectNotExisting?(e(new Error("locize project ".concat(this.options.projectId," does not exist!"))),t):(this.getLanguagesCalls=this.getLanguagesCalls||[],this.getLanguagesCalls.push(e),this.getLanguagesCalls.length>1||this.loadUrl({},i,(function(e,t,n){if(!o.somethingLoaded&&n&&n.resourceNotExisting){o.isProjectNotExisting=!0,o.storage.setProjectNotExisting(o.options.projectId);var i=new Error("locize project ".concat(o.options.projectId," does not exist!")),r=o.getLanguagesCalls;return o.getLanguagesCalls=[],r.forEach((function(e){return e(i)}))}if(t){o.loadedLanguages=Object.keys(t);var s=o.loadedLanguages.reduce((function(e,o){return t[o].isReferenceLanguage&&(e=o),e}),"");s&&o.options.referenceLng!==s&&(o.options.referenceLng=s)}o.somethingLoaded=!0;var a=o.getLanguagesCalls;o.getLanguagesCalls=[],a.forEach((function(o){return o(e,t)}))})),t)}},{key:"getOptions",value:function(e){var t,o=this;return e||(t=p(),e=function(e,o){if(e)return t.reject(e);t.resolve(o)}),this.getLanguages((function(t,n){if(t)return e(t);var i=Object.keys(n);if(!i.length)return e(new Error("was unable to load languages via API"));var r=i.reduce((function(e,t){var i=n[t];return i.translated[o.options.version]&&i.translated[o.options.version]>=o.options.translatedPercentageThreshold&&e.push(t),e}),[]),s=i.reduce((function(e,t){return t.indexOf("-")>-1||e}),!1);e(null,{fallbackLng:o.options.referenceLng,referenceLng:o.options.referenceLng,supportedLngs:0===r.length&&o.options.referenceLng?[o.options.referenceLng]:r,load:s?"all":"languageOnly"},n)})),t}},{key:"checkIfProjectExists",value:function(e){var t=this,o=(this.services||{logger:console}).logger;this.somethingLoaded?e&&e(null):this.alreadyRequestedCheckIfProjectExists?setTimeout((function(){return t.checkIfProjectExists(e)}),S(this.options.checkForProjectTimeout)):(this.alreadyRequestedCheckIfProjectExists=!0,this.getLanguages((function(t){t&&t.message&&t.message.indexOf("does not exist")>0&&o&&o.error(t.message),e&&e(t)})))}},{key:"checkIfLanguagesLoaded",value:function(e){var t=(this.services||{logger:console}).logger;this.loadedLanguages?e&&e(null):this.getLanguages((function(o){o&&o.message&&o.message.indexOf("does not exist")>0&&t&&t.error(o.message),e&&e(o)}))}},{key:"read",value:function(e,t,o){var n,i=this,r=(this.services||{logger:console}).logger,s={};if(this.options.private){var a=d(this.options,["projectId","version","apiKey"]);if(a)return o(new Error(a),!1);n=f(this.options.privatePath,{lng:e,ns:t,projectId:this.options.projectId,version:this.options.version}),s={authorize:!0}}else{var c=d(this.options,["projectId","version"]);if(c)return o(new Error(c),!1);n=f(this.options.loadPath,{lng:e,ns:t,projectId:this.options.projectId,version:this.options.version})}if(!this.isProjectNotExisting&&this.storage.isProjectNotExisting(this.options.projectId)&&(this.isProjectNotExisting=!0),this.isProjectNotExisting){var u=new Error("locize project ".concat(this.options.projectId," does not exist!"));return r&&r.error(u.message),void(o&&o(u))}if(this.warnedLanguages&&this.warnedLanguages.indexOf(e)>-1){var l=new Error('Will not continue to load language "'.concat(e,'" since it is not available in locize project ').concat(this.options.projectId,"!"));return r&&r.error(l.message),void(o&&o(l))}this.loadUrl(s,n,(function(t,n,s){var a=s&&s.resourceNotExisting;a||(i.hasResourcesForLng||(i.hasResourcesForLng={}),i.hasResourcesForLng[e]=!0),!a||i.hasResourcesForLng&&i.hasResourcesForLng[e]||setTimeout((function(){i.checkIfLanguagesLoaded((function(){i.loadedLanguages&&(i.loadedLanguages.indexOf(e)>-1||i.warnedLanguages&&i.warnedLanguages.indexOf(e)>-1||(i.warnedLanguages||(i.warnedLanguages=[]),i.warnedLanguages.push(e),r&&r.warn('Language "'.concat(e,'" is not available in locize project ').concat(i.options.projectId,"!"))))}))}),S(i.options.checkForProjectTimeout)),i.somethingLoaded||(a?setTimeout((function(){return i.checkIfProjectExists()}),S(i.options.checkForProjectTimeout)):i.somethingLoaded=!0),o(t,n)}))}},{key:"loadUrl",value:function(e,t,o,n){var i=this;e=s(e,this.options),"function"==typeof o&&(n=o,o=void 0),n=n||function(){};var r=function(e,o){var r,s,a=o&&o.resourceNotExisting;if(o&&(408===o.status||400===o.status))return n("failed loading "+t,!0,{resourceNotExisting:a});if(o&&(o.status>=500&&o.status<600||!o.status))return n("failed loading "+t,!0,{resourceNotExisting:a});if(o&&o.status>=400&&o.status<500)return n("failed loading "+t,!1,{resourceNotExisting:a});if(!o&&e&&e.message){var c=e.message.toLowerCase();if(["failed","fetch","network","load"].find((function(e){return c.indexOf(e)>-1})))return n("failed loading "+t+": "+e.message,!0,{resourceNotExisting:a})}if(e)return n(e,!1);try{r="string"==typeof o.data?JSON.parse(o.data):o.data}catch(e){s="failed parsing "+t+" to json"}return s?n(s,!1):i.options.failLoadingOnEmptyJSON&&!Object.keys(r).length?n("loaded result empty for "+t,!1,{resourceNotExisting:a}):void n(null,r,{resourceNotExisting:a})};if(!this.options.request||t.indexOf("/languages/".concat(e.projectId))>0)return w(e,t,o,r);var a=j(t,e,o);O(this.options,a,r)}},{key:"create",value:function(e,t,o,n,i,r){var s=this;"function"!=typeof i&&(i=function(){}),this.checkIfProjectExists((function(a){if(a)return i(a);var c=d(s.options,["projectId","version","apiKey","referenceLng"]);return c?i(new Error(c)):s.isAddOrUpdateAllowed?("string"==typeof e&&(e=[e]),e.filter((function(e){return e===s.options.referenceLng})).length<1&&s.services&&s.services.logger&&s.services.logger.warn('locize-backend: will not save missings because the reference language "'.concat(s.options.referenceLng,'" was not in the list of to save languages: ').concat(e.join(", ")," (open your site in the reference language to save missings).")),void e.forEach((function(e){e===s.options.referenceLng&&s.queue.call(s,s.options.referenceLng,t,o,n,i,r)}))):i("host is not allowed to create key.")}))}},{key:"update",value:function(e,t,o,n,i,r){var s=this;"function"!=typeof i&&(i=function(){}),this.checkIfProjectExists((function(a){if(a)return i(a);var c=d(s.options,["projectId","version","apiKey","referenceLng"]);return c?i(new Error(c)):s.isAddOrUpdateAllowed?(r||(r={}),"string"==typeof e&&(e=[e]),r.isUpdate=!0,void e.forEach((function(e){e===s.options.referenceLng&&s.queue.call(s,s.options.referenceLng,t,o,n,i,r)}))):i("host is not allowed to update key.")}))}},{key:"writePage",value:function(e,t,o,n){var i=f(this.options.addPath,{lng:e,ns:t,projectId:this.options.projectId,version:this.options.version}),r=f(this.options.updatePath,{lng:e,ns:t,projectId:this.options.projectId,version:this.options.version}),a=!1,c=!1,u={},l={};o.forEach((function(e){var t=e.options&&e.options.tDescription?{value:e.fallbackValue||"",context:{text:e.options.tDescription}}:e.fallbackValue||"";e.options&&e.options.isUpdate?(c||(c=!0),l[e.key]=t):(a||(a=!0),u[e.key]=t)}));var d=0;a&&d++,c&&d++;var p=function(e){--d||n(e)};if(d||p(),a)if(this.options.request){var g=j(i,s({authorize:!0},this.options),u);O(this.options,g,p)}else w(s({authorize:!0},this.options),i,u,p);if(c)if(this.options.request){var h=j(r,s({authorize:!0},this.options),l);O(this.options,h,p)}else w(s({authorize:!0},this.options),r,l,p)}},{key:"write",value:function(e,t){var o=this;if(!u(this.queuedWrites,["locks",e,t])){var n=u(this.queuedWrites,[e,t]);c(this.queuedWrites,[e,t],[]);var i=1e3,r=n.filter((function(e){return e.callback})).map((function(e){return e.callback}));if(n.length){c(this.queuedWrites,["locks",e,t],!0);var s=function(){c(o.queuedWrites,["locks",e,t],!1),r.forEach((function(e){return e()})),o.options.onSaved&&o.options.onSaved(e,t),o.debouncedProcess(e,t)},a=n.length/i,l=0,f=n.splice(0,i);for(this.writePage(e,t,f,(function(){++l>=a&&s()}));f.length===i;)(f=n.splice(0,i)).length&&this.writePage(e,t,f,(function(){++l>=a&&s()}))}}}},{key:"process",value:function(){var e=this;Object.keys(this.queuedWrites).forEach((function(t){"locks"!==t&&Object.keys(e.queuedWrites[t]).forEach((function(o){e.queuedWrites[t][o].length&&e.write(t,o)}))}))}},{key:"queue",value:function(e,t,o,n,i,r){!function(e,t,o,n){var i=a(e,t,Object),r=i.obj,s=i.k;r[s]=r[s]||[],n&&(r[s]=r[s].concat(o)),n||r[s].push(o)}(this.queuedWrites,[e,t],{key:o,fallbackValue:n||"",callback:i,options:r}),this.debouncedProcess()}}],I&&m(E.prototype,I),P&&m(E,P),Object.defineProperty(E,"prototype",{writable:!1}),E);T.type="backend";const{slice:z,forEach:A}=[];const q=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,N={create(e,t,o,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/",sameSite:"strict"};o&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+60*o*1e3)),n&&(i.domain=n),document.cookie=function(e,t){const o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{path:"/"};let n=`${e}=${encodeURIComponent(t)}`;if(o.maxAge>0){const e=o.maxAge-0;if(Number.isNaN(e))throw new Error("maxAge should be a Number");n+=`; Max-Age=${Math.floor(e)}`}if(o.domain){if(!q.test(o.domain))throw new TypeError("option domain is invalid");n+=`; Domain=${o.domain}`}if(o.path){if(!q.test(o.path))throw new TypeError("option path is invalid");n+=`; Path=${o.path}`}if(o.expires){if("function"!=typeof o.expires.toUTCString)throw new TypeError("option expires is invalid");n+=`; Expires=${o.expires.toUTCString()}`}if(o.httpOnly&&(n+="; HttpOnly"),o.secure&&(n+="; Secure"),o.sameSite)switch("string"==typeof o.sameSite?o.sameSite.toLowerCase():o.sameSite){case!0:n+="; SameSite=Strict";break;case"lax":n+="; SameSite=Lax";break;case"strict":n+="; SameSite=Strict";break;case"none":n+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return o.partitioned&&(n+="; Partitioned"),n}(e,t,i)},read(e){const t=`${e}=`,o=document.cookie.split(";");for(let e=0;e<o.length;e++){let n=o[e];for(;" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return n.substring(t.length,n.length)}return null},remove(e,t){this.create(e,"",-1,t)}};var R={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&"undefined"!=typeof document)return N.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:o,cookieMinutes:n,cookieDomain:i,cookieOptions:r}=t;o&&"undefined"!=typeof document&&N.create(o,e,n,i,r)}},H={name:"querystring",lookup(e){let t,{lookupQuerystring:o}=e;if("undefined"!=typeof window){let{search:e}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(e=window.location.hash.substring(window.location.hash.indexOf("?")));const n=e.substring(1).split("&");for(let e=0;e<n.length;e++){const i=n[e].indexOf("=");if(i>0){n[e].substring(0,i)===o&&(t=n[e].substring(i+1))}}}return t}},U={name:"hash",lookup(e){let t,{lookupHash:o,lookupFromHashIndex:n}=e;if("undefined"!=typeof window){const{hash:e}=window.location;if(e&&e.length>2){const i=e.substring(1);if(o){const e=i.split("&");for(let n=0;n<e.length;n++){const i=e[n].indexOf("=");if(i>0){e[n].substring(0,i)===o&&(t=e[n].substring(i+1))}}}if(t)return t;if(!t&&n>-1){const t=e.match(/\/([a-zA-Z-]*)/g);if(!Array.isArray(t))return;const o="number"==typeof n?n:0;return t[o]?.replace("/","")}}}return t}};let C=null;const M=()=>{if(null!==C)return C;try{if(C="undefined"!=typeof window&&null!==window.localStorage,!C)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch(e){C=!1}return C};var X={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&M())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:o}=t;o&&M()&&window.localStorage.setItem(o,e)}};let D=null;const F=()=>{if(null!==D)return D;try{if(D="undefined"!=typeof window&&null!==window.sessionStorage,!D)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch(e){D=!1}return D};var K={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&F())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:o}=t;o&&F()&&window.sessionStorage.setItem(o,e)}},$={name:"navigator",lookup(e){const t=[];if("undefined"!=typeof navigator){const{languages:e,userLanguage:o,language:n}=navigator;if(e)for(let o=0;o<e.length;o++)t.push(e[o]);o&&t.push(o),n&&t.push(n)}return t.length>0?t:void 0}},J={name:"htmlTag",lookup(e){let t,{htmlTag:o}=e;const n=o||("undefined"!=typeof document?document.documentElement:null);return n&&"function"==typeof n.getAttribute&&(t=n.getAttribute("lang")),t}},_={name:"path",lookup(e){let{lookupFromPathIndex:t}=e;if("undefined"==typeof window)return;const o=window.location.pathname.match(/\/([a-zA-Z-]*)/g);if(!Array.isArray(o))return;const n="number"==typeof t?t:0;return o[n]?.replace("/","")}},W={name:"subdomain",lookup(e){let{lookupFromSubdomainIndex:t}=e;const o="number"==typeof t?t+1:1,n="undefined"!=typeof window&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(n)return n[o]}};let G=!1;try{document.cookie,G=!0}catch(E){}const V=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];G||V.splice(1,1);class B{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{languageUtils:{}},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e,this.options=function(e){return A.call(z.call(arguments,1),(t=>{if(t)for(const o in t)void 0===e[o]&&(e[o]=t[o])})),e}(t,this.options||{},{order:V,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e}),"string"==typeof this.options.convertDetectedLanguage&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=e=>e.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=o,this.addDetector(R),this.addDetector(H),this.addDetector(X),this.addDetector(K),this.addDetector($),this.addDetector(J),this.addDetector(_),this.addDetector(W),this.addDetector(U)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.order,t=[];return e.forEach((e=>{if(this.detectors[e]){let o=this.detectors[e].lookup(this.options);o&&"string"==typeof o&&(o=[o]),o&&(t=t.concat(o))}})),t=t.filter((e=>{return null!=e&&!("string"==typeof(t=e)&&[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some((e=>e.test(t))));var t})).map((e=>this.options.convertDetectedLanguage(e))),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.caches;t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach((t=>{this.detectors[t]&&this.detectors[t].cacheUserLanguage(e,this.options)})))}}B.type="languageDetector";var Q=[],Z=Q.forEach,Y=Q.slice;function ee(e){return Z.call(Y.call(arguments,1),(function(t){if(t)for(var o in t)void 0===e[o]&&(e[o]=t[o])})),e}function te(e){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},te(e)}var oe,ne,ie="function"==typeof fetch?fetch:void 0;if("undefined"!=typeof global&&global.fetch?ie=global.fetch:"undefined"!=typeof window&&window.fetch&&(ie=window.fetch),"function"!=typeof XMLHttpRequest&&"object"!==("undefined"==typeof XMLHttpRequest?"undefined":te(XMLHttpRequest))||("undefined"!=typeof global&&global.XMLHttpRequest?oe=global.XMLHttpRequest:"undefined"!=typeof window&&window.XMLHttpRequest&&(oe=window.XMLHttpRequest)),"function"==typeof ActiveXObject&&("undefined"!=typeof global&&global.ActiveXObject?ne=global.ActiveXObject:"undefined"!=typeof window&&window.ActiveXObject&&(ne=window.ActiveXObject)),"function"!=typeof ie&&(ie=void 0),!ie&&!oe&&!ne)try{Promise.resolve().then((function(){return me})).then((function(e){ie=e.default})).catch((function(){}))}catch(E){}var re=function(e,t,o,n){return"function"==typeof o&&(n=o,o=void 0),n=n||function(){},ie?function(e,t,o,n){var i=function(e){var t=e.headers&&"Error from cloudfront"===e.headers.get("x-cache");if(!e.ok)return n(e.statusText||"Error",{status:e.status,resourceNotExisting:t});e.text().then((function(o){n(null,{status:e.status,data:o,resourceNotExisting:t})})).catch(n)},r={Authorization:e.authorize&&e.apiKey?e.apiKey:void 0,"Content-Type":"application/json"};"undefined"==typeof window&&"undefined"!=typeof global&&void 0!==global.process&&global.process.versions&&global.process.versions.node&&(r["User-Agent"]="locize-lastused (node/".concat(global.process.version,"; ").concat(global.process.platform," ").concat(global.process.arch,")")),"function"==typeof fetch?fetch(t,{method:o?"POST":"GET",body:o?JSON.stringify(o):void 0,headers:r}).then(i).catch(n):ie(t,{method:o?"POST":"GET",body:o?JSON.stringify(o):void 0,headers:r}).then(i).catch(n)}(e,t,o,n):"function"==typeof XMLHttpRequest||"object"===("undefined"==typeof XMLHttpRequest?"undefined":te(XMLHttpRequest))||"function"==typeof ActiveXObject?function(e,t,o,n){try{var i=oe?new oe:new ne("MSXML2.XMLHTTP.3.0");i.open(o?"POST":"GET",t,1),e.crossDomain||i.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.authorize&&e.apiKey&&i.setRequestHeader("Authorization",e.apiKey),(o||e.setContentTypeJSON)&&i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=function(){var e="Error from cloudfront"===i.getResponseHeader("x-cache");i.readyState>3&&n(i.status>=400?i.statusText:null,{status:i.status,data:i.responseText,resourceNotExisting:e})},i.send(JSON.stringify(o))}catch(e){console&&console.log(e)}}(e,t,o,n):void n(new Error("No fetch and no xhr implementation found!"))},se={init:function(e){var t=e.t&&"function"==typeof e.t;t&&!e.options.locizeLastUsed.projectId&&e.options.backend.projectId&&(e.options.locizeLastUsed.projectId=e.options.backend.projectId),t&&!e.options.locizeLastUsed.version&&e.options.backend.version&&(e.options.locizeLastUsed.version=e.options.backend.version),t&&!e.options.locizeLastUsed.apiKey&&e.options.backend.apiKey&&(e.options.locizeLastUsed.apiKey=e.options.backend.apiKey),t&&!e.options.locizeLastUsed.referenceLng&&e.options.backend.referenceLng&&(e.options.locizeLastUsed.referenceLng=e.options.backend.referenceLng),t&&!e.options.locizeLastUsed.referenceLng&&e.options.fallbackLng&&Array.isArray(e.options.fallbackLng)&&"dev"!==e.options.fallbackLng[0]&&(e.options.locizeLastUsed.referenceLng=e.options.fallbackLng[0]),this.options=ee(t?e.options.locizeLastUsed:e,this.options||{},{lastUsedPath:"https://api.locize.app/used/{{projectId}}/{{version}}/{{lng}}/{{ns}}",referenceLng:"en",crossDomain:!0,setContentTypeJSON:!1,version:"latest",debounceSubmit:9e4,allowedHosts:["localhost"]});var o,n,i,r,s="undefined"!=typeof window&&window.location&&window.location.hostname;this.isAllowed=!s||this.options.allowedHosts.indexOf(s)>-1,this.submitting=null,this.pending={},this.done={},this.submit=(o=this.submit,n=this.options.debounceSubmit,function(){var e=this,t=arguments,s=i&&!r;clearTimeout(r),r=setTimeout((function(){r=null,i||o.apply(e,t)}),n),s&&o.apply(e,t)}),t&&this.interceptI18next(e)},interceptI18next:function(e){var t=this,o=e.services.resourceStore.getResource;e.services.resourceStore.getResource=function(n,i,r,s){return r&&t.used(i,r),o.call(e.services.resourceStore,n,i,r,s)}},used:function(e,t,o){var n=this;["pending","done"].forEach((function(o){n.done[e]&&n.done[e][t]||(n[o][e]||(n[o][e]={}),n[o][e][t]=!0)})),this.submit(o)},submit:function(e){var t=this;if(!this.isAllowed)return e&&e(new Error("not allowed"));if(this.submitting)return this.submit(e);var o,n=(o=this.options,["projectId","version","apiKey","referenceLng"].reduce((function(e,t){if(e)return e;if(!o||!o[t]||"string"!=typeof o[t]||!o[t].toLowerCase()===t.toLowerCase()){var n='i18next-lastused :: got "'.concat(o[t],'" in options for ').concat(t," which is invalid.");return console.warn(n),n}return!1}),!1));if(n)return e&&e(new Error(n));this.submitting=this.pending,this.pending={};var i=Object.keys(this.submitting),r=i.length,s=function(o){--r||(t.submitting=null,e&&e(o))};i.forEach((function(e){var o=Object.keys(t.submitting[e]),n=function(e,t,o){var n=e;return t.forEach((function(e){var t=new RegExp("{{".concat(e,"}}"),"g");n=n.replace(t,o[e])})),n}(t.options.lastUsedPath,["projectId","version","lng","ns"],ee({lng:t.options.referenceLng,ns:e},t.options));o.length?re(ee({authorize:!0},t.options),n,o,s):s()}))},type:"3rdParty"},ae=new RegExp("{{(.+?)}}","g");function ce(e){if(e.indexOf("-")<0)return e;var t=e.split("-");return["NB-NO","NN-NO","nb-NO","nn-NO","nb-no","nn-no"].indexOf(e)>-1?t[1].toLowerCase():t[0]}function ue(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ue(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var fe={interpolator:{interpolate:function(e,t,o){for(var n,i,r;n=ae.exec(e);)"string"!=typeof(i=n[1].trim())&&(i=null==(r=i)?"":""+r),i||(i=""),i=i.replace(/\$/g,"$$$$"),e=e.replace(n[0],t[i]||i),ae.lastIndex=0;return e}},languageUtils:{formatLanguageCode:function(e){return e}}},de={init:function(e){return this.options=e,this.backend=new T(fe,e),this.detector=new B(fe,e),this.lng=e.lng||this.detector.detect(),this.referenceLng=e.referenceLng,se.init(e),this},isValid:function(e,t){return e[t]&&e[t].translated[this.options.version||"latest"]>=(this.options.loadIfTranslatedOver||1)},getLanguage:function(e,t){var o=this;return"function"==typeof e&&(t=e,e=this.lng),e||(e=this.lng),this.getLanguages((function(n,i){return n?t(n):o.isValid(i,e)?t(null,e):o.isValid(i,ce(e))?t(null,ce(e)):void t(null,o.options.fallbackLng||o.referenceLng||Object.keys(i)[0])})),this},getLanguages:function(e){var t=this;return this.publishedLngs?e(null,this.publishedLngs):this.backend.getLanguages((function(o,n){if(o)return e(o);o||(t.publishedLngs=n),t.referenceLng||Object.keys(n).forEach((function(e){n[e].isReferenceLanguage&&(t.referenceLng=e)})),e(null,n)})),this},load:function(e,t,o){var n=this;return"function"==typeof t&&(o=t,t=null),this.getLanguage(t,(function(t,i){if(t)return o(t);n.backend.read(i,e,(function(e,t){return o(e,t,i)}))})),this},loadAll:function(e,t){var n=this;return this.getLanguages((function(i,r){if(i)return t(i);!function(e,t,o){var n=[],i=e.length;e.forEach((function(e,r){t(e,(function(e,t){n[r]=t,e&&(o&&o(e),o=null),0==--i&&o&&o(null,n)}))}))}(Object.keys(r).filter((function(e){return n.isValid(r,e)})),(function(t,i){n.load(e,t,(function(e,n){if(e)return i(e);i(null,o({},t,n))}))}),(function(e,o){if(e)return t(e);var n=o.reduce((function(e,t){return le(le({},e),t)}),{});t(null,n)}))})),this},add:function(e,t,o,n,i){var r={};return"function"==typeof n?i=n:"string"==typeof n&&(r.tDescription=n),this.backend.create(this.referenceLng,e,t,o,i,r),this},update:function(e,t,o,n,i){var r={isUpdate:!0};return"function"==typeof n?i=n:"string"==typeof n&&(r.tDescription=n),this.backend.create(this.referenceLng,e,t,o,i,r),this},used:function(e,t){se.used(e,t)}};const pe=require("node-fetch"),ge=pe.default||pe,he=function(e,t){return/^\/\//.test(e)&&(e="https:"+e),ge.call(this,e,t)};he.ponyfill=!0,module.exports=exports=he,exports.fetch=he,exports.Headers=pe.Headers,exports.Request=pe.Request,exports.Response=pe.Response,exports.default=he;var ve=Object.freeze({__proto__:null});const ye=require("node-fetch"),we=ye.default||ye,be=function(e,t){return/^\/\//.test(e)&&(e="https:"+e),we.call(this,e,t)};be.ponyfill=!0,module.exports=exports=be,exports.fetch=be,exports.Headers=ye.Headers,exports.Request=ye.Request,exports.Response=ye.Response,exports.default=be;var me=Object.freeze({__proto__:null});return de}));

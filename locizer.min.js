!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).locizer=e()}(this,(function(){"use strict";const t=[],e=t.forEach,o=t.slice;function i(t){return e.call(o.call(arguments,1),e=>{if(e)for(var o in e)void 0===t[o]&&(t[o]=e[o])}),t}function n(t,e,o){function i(t){return t&&t.indexOf("###")>-1?t.replace(/###/g,"."):t}const n="string"!=typeof e?[].concat(e):e.split(".");for(;n.length>1;){if(!t)return{};const e=i(n.shift());!t[e]&&o&&(t[e]=new o),t=t[e]}return t?{obj:t,k:i(n.shift())}:{}}function s(t,e,o){const{obj:i,k:s}=n(t,e,Object);i[s]=o}function r(t,e){const{obj:o,k:i}=n(t,e);if(o)return o[i]}const a=new RegExp("{{(.+?)}}","g");function c(t,e,o){let i,n;for(;i=a.exec(t);)n=i[1].trim(),"string"!=typeof n&&(n=null==(s=n)?"":""+s),n||(n=""),n=n.replace(/\$/g,"$$$$"),t=t.replace(i[0],e[n]||n),a.lastIndex=0;var s;return t}function l(t,e){return e.reduce((e,o)=>{if(e)return e;if(!t||!t[o]||"string"!=typeof t[o]||!t[o].toLowerCase()===o.toLowerCase()){const e=`i18next-locize-backend :: got "${t[o]}" in options for ${o} which is invalid.`;return console.warn(e),e}return!1},!1)}var u;if("function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?u=global.fetch:"undefined"!=typeof window&&window.fetch&&(u=window.fetch)),"undefined"!=typeof require&&("undefined"==typeof window||void 0===window.document)){var d=u||require("node-fetch");d.default&&(d=d.default),exports.default=d,module.exports=exports.default}var h=Object.freeze({__proto__:null});let p,f,g;"function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?p=global.fetch:"undefined"!=typeof window&&window.fetch&&(p=window.fetch)),"function"==typeof XMLHttpRequest&&("undefined"!=typeof global&&global.XMLHttpRequest?f=global.XMLHttpRequest:"undefined"!=typeof window&&window.XMLHttpRequest&&(f=window.XMLHttpRequest)),"function"==typeof ActiveXObject&&("undefined"!=typeof global&&global.ActiveXObject?g=global.ActiveXObject:"undefined"!=typeof window&&window.ActiveXObject&&(g=window.ActiveXObject)),p||!h||f||g||(p=h),"function"!=typeof p&&(p=void 0);const v=(t,e,o,i)=>("function"==typeof o&&(i=o,o=void 0),i=i||(()=>{}),p?((t,e,o,i)=>{p(e,{method:o?"POST":"GET",body:o?JSON.stringify(o):void 0,headers:{Authorization:t.authorize&&t.apiKey?t.apiKey:void 0,"Content-Type":"application/json"}}).then(t=>{const e=t.headers&&"Error from cloudfront"===t.headers.get("x-cache");if(!t.ok)return i(t.statusText||"Error",{status:t.status,resourceNotExisting:e});t.text().then(o=>{i(null,{status:t.status,data:o,resourceNotExisting:e})}).catch(i)}).catch(i)})(t,e,o,i):"function"==typeof XMLHttpRequest||"function"==typeof ActiveXObject?((t,e,o,i)=>{try{let n;n=f?new f:new g("MSXML2.XMLHTTP.3.0"),n.open(o?"POST":"GET",e,1),t.crossDomain||n.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.authorize&&t.apiKey&&n.setRequestHeader("Authorization",t.apiKey),(o||t.setContentTypeJSON)&&n.setRequestHeader("Content-Type","application/json"),n.onreadystatechange=()=>{const t="Error from cloudfront"===n.getResponseHeader("x-cache");n.readyState>3&&i(n.status>=400?n.statusText:null,{status:n.status,data:n.responseText,resourceNotExisting:t})},n.send(JSON.stringify(o))}catch(t){console&&console.log(t)}})(t,e,o,i):void 0);let w;try{w="undefined"!=typeof window&&null!==window.localStorage;const t="notExistingLocizeProject";window.localStorage.setItem(t,"foo"),window.localStorage.removeItem(t)}catch(t){w=!1}class y{constructor(t,e={},o={},i){this.services=t,this.options=e,this.allOptions=o,this.type="backend",t&&t.projectId?this.init(null,t,o,e):this.init(t,e,o,i)}init(t,e={},o={},n){this.services=t,this.options=i(e,this.options||{},{loadPath:"https://api.locize.app/{{projectId}}/{{version}}/{{lng}}/{{ns}}",privatePath:"https://api.locize.app/private/{{projectId}}/{{version}}/{{lng}}/{{ns}}",getLanguagesPath:"https://api.locize.app/languages/{{projectId}}",addPath:"https://api.locize.app/missing/{{projectId}}/{{version}}/{{lng}}/{{ns}}",updatePath:"https://api.locize.app/update/{{projectId}}/{{version}}/{{lng}}/{{ns}}",referenceLng:"en",crossDomain:!0,setContentTypeJSON:!1,version:"latest",private:!1,whitelistThreshold:.9,failLoadingOnEmptyJSON:!1,allowedAddOrUpdateHosts:["localhost"],onSaved:!1,reloadInterval:36e5,checkForProjectTimeout:3e3,storageExpiration:36e5}),this.allOptions=o,this.somethingLoaded=!1,this.isProjectNotExisting=!1,this.storage=function(t){let e=()=>{},o=()=>{};return w?(e=t=>{window.localStorage.setItem("notExistingLocizeProject_"+t,Date.now())},o=e=>{const o=window.localStorage.getItem("notExistingLocizeProject_"+e);return!!o&&(!(Date.now()-o>t)||(window.localStorage.removeItem("notExistingLocizeProject_"+e),!1))}):"undefined"!=typeof document&&(e=e=>{const o=new Date;o.setTime(o.getTime()+t);const i="; expires="+o.toGMTString(),n="notExistingLocizeProject_"+e;document.cookie=`${n}=${Date.now()}${i};path=/`},o=t=>{const e="notExistingLocizeProject_"+t+"=",o=document.cookie.split(";");for(let t=0;t<o.length;t++){let i=o[t];for(;" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(e))return!0}return!1}),{setProjectNotExisting:e,isProjectNotExisting:o}}(this.options.storageExpiration),this.options.pull&&console.warn('The pull API was removed use "private: true" option instead: https://docs.locize.com/integration/api#fetch-private-namespace-resources');const s="undefined"!=typeof window&&window.location&&window.location.hostname;var r,a,c,l;s?(this.isAddOrUpdateAllowed="function"==typeof this.options.allowedAddOrUpdateHosts?this.options.allowedAddOrUpdateHosts(s):this.options.allowedAddOrUpdateHosts.indexOf(s)>-1,t&&t.logger&&(o.saveMissing||o.updateMissing)&&(this.isAddOrUpdateAllowed?"localhost"!==s&&t.logger.warn(`locize-backend: you are using the save or update missings feature from this host "${s}".\nMake sure you will not use it in production!\nhttps://docs.locize.com/guides-tips-and-tricks/going-production`):t.logger.warn("function"==typeof this.options.allowedAddOrUpdateHosts?`locize-backend: will not save or update missings because allowedAddOrUpdateHosts returned false for the host "${s}".`:`locize-backend: will not save or update missings because the host "${s}" was not in the list of allowedAddOrUpdateHosts: ${this.options.allowedAddOrUpdateHosts.join(", ")} (matches need to be exact).`))):this.isAddOrUpdateAllowed=!0,"function"==typeof n&&this.getOptions((t,o)=>{if(t)return n(t);this.options.referenceLng=e.referenceLng||o.referenceLng||this.options.referenceLng,n(null,o)}),this.queuedWrites={pending:{}},this.debouncedProcess=(r=this.process,a=1e4,function(){var t=this,e=arguments,o=function(){l=null,c||r.apply(t,e)},i=c&&!l;clearTimeout(l),l=setTimeout(o,a),i&&r.apply(t,e)}),this.interval&&clearInterval(this.interval),this.options.reloadInterval&&(this.interval=setInterval(()=>this.reload(),this.options.reloadInterval))}reload(){const{backendConnector:t,languageUtils:e,logger:o}=this.services;if(!t)return;const i=t.language;if(i&&"cimode"===i.toLowerCase())return;const n=[],s=t=>{e.toResolveHierarchy(t).forEach(t=>{n.indexOf(t)<0&&n.push(t)})};s(i),this.allOptions.preload&&this.allOptions.preload.forEach(t=>s(t)),n.forEach(e=>{this.allOptions.ns.forEach(i=>{t.read(e,i,"read",null,null,(n,s)=>{n&&o.warn(`loading namespace ${i} for language ${e} failed`,n),!n&&s&&o.log(`loaded namespace ${i} for language ${e}`,s),t.loaded(`${e}|${i}`,n,s)})})})}getLanguages(t){const e=l(this.options,["projectId"]);if(e)return t(new Error(e));const o=c(this.options.getLanguagesPath,{projectId:this.options.projectId});if(!this.isProjectNotExisting&&this.storage.isProjectNotExisting(this.options.projectId)&&(this.isProjectNotExisting=!0),this.isProjectNotExisting)return t(new Error(`locize project ${this.options.projectId} does not exist!`));this.loadUrl({},o,(e,o,i)=>{if(!this.somethingLoaded&&i&&i.resourceNotExisting)return this.isProjectNotExisting=!0,this.storage.setProjectNotExisting(this.options.projectId),t(new Error(`locize project ${this.options.projectId} does not exist!`));this.somethingLoaded=!0,t(e,o)})}getOptions(t){this.getLanguages((e,o)=>{if(e)return t(e);const i=Object.keys(o);if(!i.length)return t(new Error("was unable to load languages via API"));const n=i.reduce((t,e)=>(o[e].isReferenceLanguage&&(t=e),t),""),s=i.reduce((t,e)=>{const i=o[e];return i.translated[this.options.version]&&i.translated[this.options.version]>=this.options.whitelistThreshold&&t.push(e),t},[]),r=i.reduce((t,e)=>e.indexOf("-")>-1||t,!1);t(null,{fallbackLng:n,referenceLng:n,whitelist:s,load:r?"all":"languageOnly"})})}checkIfProjectExists(t){const{logger:e}=this.services;this.somethingLoaded?t&&t(null):this.alreadyRequestedCheckIfProjectExists?setTimeout(()=>this.checkIfProjectExists(t),this.options.checkForProjectTimeout):(this.alreadyRequestedCheckIfProjectExists=!0,this.getLanguages(o=>{o&&o.message&&o.message.indexOf("does not exist")>0&&e&&e.error(o.message),t&&t(o)}))}read(t,e,o){const{logger:i}=this.services||{logger:console};let n,s={};if(this.options.private){const i=l(this.options,["projectId","version","apiKey"]);if(i)return o(new Error(i),!1);n=c(this.options.privatePath,{lng:t,ns:e,projectId:this.options.projectId,version:this.options.version}),s={authorize:!0}}else{const i=l(this.options,["projectId","version"]);if(i)return o(new Error(i),!1);n=c(this.options.loadPath,{lng:t,ns:e,projectId:this.options.projectId,version:this.options.version})}if(!this.isProjectNotExisting&&this.storage.isProjectNotExisting(this.options.projectId)&&(this.isProjectNotExisting=!0),this.isProjectNotExisting){const t=new Error(`locize project ${this.options.projectId} does not exist!`);return i&&i.error(t.message),void(o&&o(t))}this.loadUrl(s,n,(t,e,i)=>{this.somethingLoaded||(i&&i.resourceNotExisting?setTimeout(()=>this.checkIfProjectExists(),this.options.checkForProjectTimeout):this.somethingLoaded=!0),o(t,e)})}loadUrl(t,e,o,n){t=i(t,this.options),"function"==typeof o&&(n=o,o=void 0),n=n||(()=>{}),v(t,e,o,(t,o)=>{const i=o&&o.resourceNotExisting;if(o&&(408===o.status||400===o.status))return n("failed loading "+e,!0,{resourceNotExisting:i});if(o&&o.status>=500&&o.status<600)return n("failed loading "+e,!0,{resourceNotExisting:i});if(o&&o.status>=400&&o.status<500)return n("failed loading "+e,!1,{resourceNotExisting:i});if(t)return n(t,!1);let s,r;try{s=JSON.parse(o.data)}catch(t){r="failed parsing "+e+" to json"}return r?n(r,!1):this.options.failLoadingOnEmptyJSON&&!Object.keys(s).length?n("loaded result empty for "+e,!1,{resourceNotExisting:i}):void n(null,s,{resourceNotExisting:i})})}create(t,e,o,i,n,s){n||(n=()=>{}),this.checkIfProjectExists(r=>{if(r)return n(r);const a=l(this.options,["projectId","version","apiKey","referenceLng"]);return a?n(new Error(a)):this.isAddOrUpdateAllowed?("string"==typeof t&&(t=[t]),t.filter(t=>t===this.options.referenceLng).length<1&&this.services&&this.services.logger&&this.services.logger.warn(`locize-backend: will not save missings because the reference language "${this.options.referenceLng}" was not in the list of to save languages: ${t.join(", ")} (open your site in the reference language to save missings).`),void t.forEach(t=>{t===this.options.referenceLng&&this.queue.call(this,this.options.referenceLng,e,o,i,n,s)})):n("host is not allowed to create key.")})}update(t,e,o,i,n,s){n||(n=()=>{}),this.checkIfProjectExists(r=>{if(r)return n(r);const a=l(this.options,["projectId","version","apiKey","referenceLng"]);return a?n(new Error(a)):this.isAddOrUpdateAllowed?(s||(s={}),"string"==typeof t&&(t=[t]),s.isUpdate=!0,void t.forEach(t=>{t===this.options.referenceLng&&this.queue.call(this,this.options.referenceLng,e,o,i,n,s)})):n("host is not allowed to update key.")})}writePage(t,e,o,n){const s=c(this.options.addPath,{lng:t,ns:e,projectId:this.options.projectId,version:this.options.version}),r=c(this.options.updatePath,{lng:t,ns:e,projectId:this.options.projectId,version:this.options.version});let a=!1,l=!1;const u={},d={};o.forEach(t=>{const e=t.options&&t.options.tDescription?{value:t.fallbackValue||"",context:{text:t.options.tDescription}}:t.fallbackValue||"";t.options&&t.options.isUpdate?(l||(l=!0),d[t.key]=e):(a||(a=!0),u[t.key]=e)});let h=0;a&&h++,l&&h++;const p=t=>{h--,h||n(t)};h||p(),a&&v(i({authorize:!0},this.options),s,u,p),l&&v(i({authorize:!0},this.options),r,d,p)}write(t,e){if(r(this.queuedWrites,["locks",t,e]))return;const o=r(this.queuedWrites,[t,e]);s(this.queuedWrites,[t,e],[]);if(o.length){s(this.queuedWrites,["locks",t,e],!0);const i=()=>{s(this.queuedWrites,["locks",t,e],!1),o.forEach(t=>{t.callback&&t.callback()}),this.options.onSaved&&this.options.onSaved(t,e),this.debouncedProcess(t,e)},n=o.length/1e3;let r=0,a=o.splice(0,1e3);for(this.writePage(t,e,a,()=>{r++,r>=n&&i()});1e3===a.length;)a=o.splice(0,1e3),a.length&&this.writePage(t,e,a,()=>{r++,r>=n&&i()})}}process(){Object.keys(this.queuedWrites).forEach(t=>{"locks"!==t&&Object.keys(this.queuedWrites[t]).forEach(e=>{this.queuedWrites[t][e].length&&this.write(t,e)})})}queue(t,e,o,i,s,r){!function(t,e,o,i){const{obj:s,k:r}=n(t,e,Object);s[r]=s[r]||[],i&&(s[r]=s[r].concat(o)),i||s[r].push(o)}(this.queuedWrites,[t,e],{key:o,fallbackValue:i||"",callback:s,options:r}),this.debouncedProcess()}}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}y.type="backend";var k=[],x=k.forEach,j=k.slice;function L(t){return x.call(j.call(arguments,1),(function(e){if(e)for(var o in e)void 0===t[o]&&(t[o]=e[o])})),t}var E,O=function(t,e,o,i){var n,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/"};if(o){var r=new Date;r.setTime(r.getTime()+60*o*1e3),n="; expires="+r.toUTCString()}else n="";i=i?"domain="+i+";":"",s=Object.keys(s).reduce((function(t,e){return t+";"+e.replace(/([A-Z])/g,(function(t){return"-"+t.toLowerCase()}))+"="+s[e]}),""),document.cookie=t+"="+encodeURIComponent(e)+n+";"+i+s},I=function(t){for(var e=t+"=",o=document.cookie.split(";"),i=0;i<o.length;i++){for(var n=o[i];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(e))return n.substring(e.length,n.length)}return null},P={name:"cookie",lookup:function(t){var e;if(t.lookupCookie&&"undefined"!=typeof document){var o=I(t.lookupCookie);o&&(e=o)}return e},cacheUserLanguage:function(t,e){e.lookupCookie&&"undefined"!=typeof document&&O(e.lookupCookie,t,e.cookieMinutes,e.cookieDomain,e.cookieOptions)}},S={name:"querystring",lookup:function(t){var e;if("undefined"!=typeof window)for(var o=window.location.search.substring(1).split("&"),i=0;i<o.length;i++){var n=o[i].indexOf("=");if(n>0)o[i].substring(0,n)===t.lookupQuerystring&&(e=o[i].substring(n+1))}return e}};try{E="undefined"!==window&&null!==window.localStorage;window.localStorage.setItem("i18next.translate.boo","foo"),window.localStorage.removeItem("i18next.translate.boo")}catch(t){E=!1}var T={name:"localStorage",lookup:function(t){var e;if(t.lookupLocalStorage&&E){var o=window.localStorage.getItem(t.lookupLocalStorage);o&&(e=o)}return e},cacheUserLanguage:function(t,e){e.lookupLocalStorage&&E&&window.localStorage.setItem(e.lookupLocalStorage,t)}},A={name:"navigator",lookup:function(t){var e=[];if("undefined"!=typeof navigator){if(navigator.languages)for(var o=0;o<navigator.languages.length;o++)e.push(navigator.languages[o]);navigator.userLanguage&&e.push(navigator.userLanguage),navigator.language&&e.push(navigator.language)}return e.length>0?e:void 0}},N={name:"htmlTag",lookup:function(t){var e,o=t.htmlTag||("undefined"!=typeof document?document.documentElement:null);return o&&"function"==typeof o.getAttribute&&(e=o.getAttribute("lang")),e}},q={name:"path",lookup:function(t){var e;if("undefined"!=typeof window){var o=window.location.pathname.match(/\/([a-zA-Z-]*)/g);if(o instanceof Array)if("number"==typeof t.lookupFromPathIndex){if("string"!=typeof o[t.lookupFromPathIndex])return;e=o[t.lookupFromPathIndex].replace("/","")}else e=o[0].replace("/","")}return e}},z={name:"subdomain",lookup:function(t){var e;if("undefined"!=typeof window){var o=window.location.href.match(/(?:http[s]*\:\/\/)*(.*?)\.(?=[^\/]*\..{2,5})/gi);o instanceof Array&&(e="number"==typeof t.lookupFromSubdomainIndex?o[t.lookupFromSubdomainIndex].replace("http://","").replace("https://","").replace(".",""):o[0].replace("http://","").replace("https://","").replace(".",""))}return e}};var U=function(){function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};m(this,t),this.type="languageDetector",this.detectors={},this.init(e,o)}var e,o,i;return e=t,(o=[{key:"init",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=t,this.options=L(e,this.options||{},{order:["querystring","cookie","localStorage","navigator","htmlTag"],lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],checkWhitelist:!0,checkForSimilarInWhitelist:!1}),this.options.checkForSimilarInWhitelist&&(this.options.checkWhitelist=!0),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=o,this.addDetector(P),this.addDetector(S),this.addDetector(T),this.addDetector(A),this.addDetector(N),this.addDetector(q),this.addDetector(z)}},{key:"addDetector",value:function(t){this.detectors[t.name]=t}},{key:"detect",value:function(t){var e=this;t||(t=this.options.order);var o,i=[];if(t.forEach((function(t){if(e.detectors[t]){var o=e.detectors[t].lookup(e.options);o&&"string"==typeof o&&(o=[o]),o&&(i=i.concat(o))}})),i.forEach((function(t){if(!o){var i=e.services.languageUtils.formatLanguageCode(t);e.options.checkWhitelist&&!e.services.languageUtils.isWhitelisted(i)||(o=i),!o&&e.options.checkForSimilarInWhitelist&&(o=e.getSimilarInWhitelist(i))}})),!o){var n=this.i18nOptions.fallbackLng;"string"==typeof n&&(n=[n]),n||(n=[]),o="[object Array]"===Object.prototype.toString.apply(n)?n[0]:n[0]||n.default&&n.default[0]}return o}},{key:"cacheUserLanguage",value:function(t,e){var o=this;e||(e=this.options.caches),e&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(t)>-1||e.forEach((function(e){o.detectors[e]&&o.detectors[e].cacheUserLanguage(t,o.options)})))}},{key:"getSimilarInWhitelist",value:function(t){var e=this;if(this.i18nOptions.whitelist){if(t.includes("-")){var o=t.split("-")[0],i=this.services.languageUtils.formatLanguageCode(o);if(this.services.languageUtils.isWhitelisted(i))return i;t=i}var n=this.i18nOptions.whitelist.find((function(o){var i=e.services.languageUtils.formatLanguageCode(o);if(i.startsWith(t))return i}));return n||void 0}}}])&&b(e.prototype,o),i&&b(e,i),t}();U.type="languageDetector";const H=[],R=H.forEach,C=H.slice;function $(t){return R.call(C.call(arguments,1),e=>{if(e)for(var o in e)void 0===t[o]&&(t[o]=e[o])}),t}var X;if("function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?X=global.fetch:"undefined"!=typeof window&&window.fetch&&(X=window.fetch)),"undefined"!=typeof require&&("undefined"==typeof window||void 0===window.document)){var M=X||require("node-fetch");M.default&&(M=M.default),exports.default=M,module.exports=exports.default}var D=Object.freeze({__proto__:null});let W,F,_;"function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?W=global.fetch:"undefined"!=typeof window&&window.fetch&&(W=window.fetch)),"function"==typeof XMLHttpRequest&&("undefined"!=typeof global&&global.XMLHttpRequest?F=global.XMLHttpRequest:"undefined"!=typeof window&&window.XMLHttpRequest&&(F=window.XMLHttpRequest)),"function"==typeof ActiveXObject&&("undefined"!=typeof global&&global.ActiveXObject?_=global.ActiveXObject:"undefined"!=typeof window&&window.ActiveXObject&&(_=window.ActiveXObject)),W||!D||F||_||(W=D),"function"!=typeof W&&(W=void 0);const K=(t,e,o,i)=>("function"==typeof o&&(i=o,o=void 0),i=i||(()=>{}),W?((t,e,o,i)=>{W(e,{method:o?"POST":"GET",body:o?JSON.stringify(o):void 0,headers:{Authorization:t.authorize&&t.apiKey?t.apiKey:void 0,"Content-Type":"application/json"}}).then(t=>{const e=t.headers&&"Error from cloudfront"===t.headers.get("x-cache");if(!t.ok)return i(t.statusText||"Error",{status:t.status,resourceNotExisting:e});t.text().then(o=>{i(null,{status:t.status,data:o,resourceNotExisting:e})}).catch(i)}).catch(i)})(t,e,o,i):"function"==typeof XMLHttpRequest||"function"==typeof ActiveXObject?((t,e,o,i)=>{try{let n;n=F?new F:new _("MSXML2.XMLHTTP.3.0"),n.open(o?"POST":"GET",e,1),t.crossDomain||n.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.authorize&&t.apiKey&&n.setRequestHeader("Authorization",t.apiKey),(o||t.setContentTypeJSON)&&n.setRequestHeader("Content-Type","application/json"),n.onreadystatechange=()=>{const t="Error from cloudfront"===n.getResponseHeader("x-cache");n.readyState>3&&i(n.status>=400?n.statusText:null,{status:n.status,data:n.responseText,resourceNotExisting:t})},n.send(JSON.stringify(o))}catch(t){console&&console.log(t)}})(t,e,o,i):void 0),J={init(t){const e=t.t&&"function"==typeof t.t;this.options=$(e?t.options.locizeLastUsed:t,this.options||{},{lastUsedPath:"https://api.locize.app/used/{{projectId}}/{{version}}/{{lng}}/{{ns}}",referenceLng:"en",crossDomain:!0,setContentTypeJSON:!1,version:"latest",debounceSubmit:9e4,allowedHosts:["localhost"]});const o="undefined"!=typeof window&&window.location&&window.location.hostname;var i,n,s,r;this.isAllowed=!o||this.options.allowedHosts.indexOf(o)>-1,this.submitting=null,this.pending={},this.done={},this.submit=(i=this.submit,n=this.options.debounceSubmit,function(){var t=this,e=arguments,o=function(){r=null,s||i.apply(t,e)},a=s&&!r;clearTimeout(r),r=setTimeout(o,n),a&&i.apply(t,e)}),e&&this.interceptI18next(t)},interceptI18next(t){const e=t.services.resourceStore.getResource;t.services.resourceStore.getResource=(o,i,n,s)=>(n&&this.used(i,n),e.call(t.services.resourceStore,o,i,n,s))},used(t,e,o){["pending","done"].forEach(o=>{this.done[t]&&this.done[t][e]||(this[o][t]||(this[o][t]={}),this[o][t][e]=!0)}),this.submit(o)},submit(t){if(!this.isAllowed)return t&&t(new Error("not allowed"));if(this.submitting)return this.submit(t);const e=(o=this.options,["projectId","version","apiKey","referenceLng"].reduce((t,e)=>{if(t)return t;if(!o||!o[e]||"string"!=typeof o[e]||!o[e].toLowerCase()===e.toLowerCase()){const t=`i18next-lastused :: got "${o[e]}" in options for ${e} which is invalid.`;return console.warn(t),t}return!1},!1));var o;if(e)return t&&t(new Error(e));this.submitting=this.pending,this.pending={};const i=Object.keys(this.submitting);let n=i.length;const s=e=>{n--,n||(this.submitting=null,t&&t(e))};i.forEach(t=>{const e=Object.keys(this.submitting[t]),o=function(t,e,o){let i=t;return e.forEach(t=>{const e=new RegExp(`{{${t}}}`,"g");i=i.replace(e,o[t])}),i}(this.options.lastUsedPath,["projectId","version","lng","ns"],$({lng:this.options.referenceLng,ns:t},this.options));e.length?K($({authorize:!0},this.options),o,e,s):s()})},type:"3rdParty"};var G=new RegExp("{{(.+?)}}","g");function V(t){if(t.indexOf("-")<0)return t;var e=t.split("-");return["NB-NO","NN-NO","nb-NO","nn-NO","nb-no","nn-no"].indexOf(t)>-1?e[1].toLowerCase():e[0]}var Q={interpolator:{interpolate:function(t,e,o){for(var i,n,s;i=G.exec(t);)"string"!=typeof(n=i[1].trim())&&(n=null==(s=n)?"":""+s),n||(n=""),n=n.replace(/\$/g,"$$$$"),t=t.replace(i[0],e[n]||n),G.lastIndex=0;return t}},languageUtils:{formatLanguageCode:function(t){return t},isWhitelisted:function(t){return!0}}};return{init:function(t){return this.options=t,this.backend=new y(Q,t),this.detector=new U(Q,t),this.lng=t.lng||this.detector.detect(),J.init(t),this},getLanguage:function(t,e){var o=this;"function"==typeof t&&(e=t,t=this.lng),t||(t=this.lng);var i=function(t,e){return t[e]&&t[e].translated[o.options.version||"latest"]>=(o.options.loadIfTranslatedOver||1)};return this.getLanguages((function(n,s){return i(s,t)?e(null,t):i(s,V(t))?e(null,V(t)):void e(null,o.options.fallbackLng||Object.keys(s)[0])})),this},getLanguages:function(t){var e=this;return this.publishedLngs?t(null,this.publishedLngs):this.backend.getLanguages((function(o,i){o||(e.publishedLngs=i),t(null,i)})),this},load:function(t,e,o){var i=this;return"function"==typeof e&&(o=e,e=null),this.getLanguage(e,(function(e,n){i.backend.read(n,t,(function(t,e){return o(t,e,n)}))})),this},add:function(t,e,o,i,n){var s={};return"function"==typeof i?n=i:"string"==typeof i&&(s.tDescription=i),this.backend.create(this.options.referenceLng,t,e,o,n,s),this},update:function(t,e,o,i,n){var s={isUpdate:!0};return"function"==typeof i?n=i:"string"==typeof i&&(s.tDescription=i),this.backend.create(this.options.referenceLng,t,e,o,n,s),this},used:function(t,e){J.used(t,e)}}}));

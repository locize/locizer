!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).locizer=e()}(this,(function(){"use strict";const t=[],e=t.forEach,o=t.slice;function n(t){return e.call(o.call(arguments,1),e=>{if(e)for(var o in e)void 0===t[o]&&(t[o]=e[o])}),t}function i(t,e,o){function n(t){return t&&t.indexOf("###")>-1?t.replace(/###/g,"."):t}const i="string"!=typeof e?[].concat(e):e.split(".");for(;i.length>1;){if(!t)return{};const e=n(i.shift());!t[e]&&o&&(t[e]=new o),t=t[e]}return t?{obj:t,k:n(i.shift())}:{}}function s(t,e,o){const{obj:n,k:s}=i(t,e,Object);n[s]=o}function r(t,e){const{obj:o,k:n}=i(t,e);if(o)return o[n]}const a=new RegExp("{{(.+?)}}","g");function c(t,e,o){let n,i;for(;n=a.exec(t);)i=n[1].trim(),"string"!=typeof i&&(i=null==(s=i)?"":""+s),i||(i=""),i=i.replace(/\$/g,"$$$$"),t=t.replace(n[0],e[i]||i),a.lastIndex=0;var s;return t}function l(t,e){return e.reduce((e,o)=>{if(e)return e;if(!t||!t[o]||"string"!=typeof t[o]||!t[o].toLowerCase()===o.toLowerCase()){const e=`i18next-locize-backend :: got "${t[o]}" in options for ${o} which is invalid.`;return console.warn(e),e}return!1},!1)}var u;if("function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?u=global.fetch:"undefined"!=typeof window&&window.fetch&&(u=window.fetch)),"undefined"!=typeof require){var d=u||require("node-fetch");d.default&&(d=d.default),exports.default=d,module.exports=exports.default}var p=Object.freeze({__proto__:null});let h,f,g;"function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?h=global.fetch:"undefined"!=typeof window&&window.fetch&&(h=window.fetch)),"function"==typeof XMLHttpRequest&&("undefined"!=typeof global&&global.XMLHttpRequest?f=global.XMLHttpRequest:"undefined"!=typeof window&&window.XMLHttpRequest&&(f=window.XMLHttpRequest)),"function"==typeof ActiveXObject&&("undefined"!=typeof global&&global.ActiveXObject?g=global.ActiveXObject:"undefined"!=typeof window&&window.ActiveXObject&&(g=window.ActiveXObject)),!h&&p&&(h=p);const w=(t,e,o,n)=>("function"==typeof o&&(n=o,o=void 0),n=n||(()=>{}),h?((t,e,o,n)=>{h(e,{method:o?"POST":"GET",body:o?JSON.stringify(o):void 0,headers:{Authorization:t.authorize&&t.apiKey?t.apiKey:void 0,"Content-Type":"application/json"}}).then(t=>{const e=t.headers&&"Error from cloudfront"===t.headers.get("x-cache");if(!t.ok)return n(t.statusText||"Error",{status:t.status,resourceNotExisting:e});t.text().then(o=>{n(null,{status:t.status,data:o,resourceNotExisting:e})}).catch(n)}).catch(n)})(t,e,o,n):"function"==typeof XMLHttpRequest||"function"==typeof ActiveXObject?((t,e,o,n)=>{try{let i;i=f?new f:new g("MSXML2.XMLHTTP.3.0"),i.open(o?"POST":"GET",e,1),t.crossDomain||i.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.authorize&&t.apiKey&&i.setRequestHeader("Authorization",t.apiKey),(o||t.setContentTypeJSON)&&i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=()=>{const t="Error from cloudfront"===i.getResponseHeader("x-cache");i.readyState>3&&n(i.statusText,{status:i.status,data:i.responseText,resourceNotExisting:t})},i.send(JSON.stringify(o))}catch(t){console&&console.log(t)}})(t,e,o,n):void 0);let v;try{v="undefined"!=typeof window&&null!==window.localStorage;const t="notExistingLocizeProject";window.localStorage.setItem(t,"foo"),window.localStorage.removeItem(t)}catch(t){v=!1}class y{constructor(t,e={},o={},n){this.services=t,this.options=e,this.allOptions=o,this.type="backend",t&&t.projectId?this.init(null,t,o,e):this.init(t,e,o,n)}init(t,e={},o={},i){this.services=t,this.options=n(e,this.options||{},{loadPath:"https://api.locize.app/{{projectId}}/{{version}}/{{lng}}/{{ns}}",privatePath:"https://api.locize.app/private/{{projectId}}/{{version}}/{{lng}}/{{ns}}",getLanguagesPath:"https://api.locize.app/languages/{{projectId}}",addPath:"https://api.locize.app/missing/{{projectId}}/{{version}}/{{lng}}/{{ns}}",updatePath:"https://api.locize.app/update/{{projectId}}/{{version}}/{{lng}}/{{ns}}",referenceLng:"en",crossDomain:!0,setContentTypeJSON:!1,version:"latest",private:!1,whitelistThreshold:.9,failLoadingOnEmptyJSON:!1,allowedAddOrUpdateHosts:["localhost"],onSaved:!1,reloadInterval:36e5,checkForProjectTimeout:3e3,storageExpiration:36e5}),this.allOptions=o,this.somethingLoaded=!1,this.isProjectNotExisting=!1,this.storage=function(t){let e=()=>{},o=()=>{};return v?(e=t=>{window.localStorage.setItem("notExistingLocizeProject_"+t,Date.now())},o=e=>{const o=window.localStorage.getItem("notExistingLocizeProject_"+e);return!!o&&(!(Date.now()-o>t)||(window.localStorage.removeItem("notExistingLocizeProject_"+e),!1))}):"undefined"!=typeof document&&(e=e=>{const o=new Date;o.setTime(o.getTime()+t);const n="; expires="+o.toGMTString(),i="notExistingLocizeProject_"+e;document.cookie=`${i}=${Date.now()}${n};path=/`},o=t=>{const e="notExistingLocizeProject_"+t+"=",o=document.cookie.split(";");for(let t=0;t<o.length;t++){let n=o[t];for(;" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(e))return!0}return!1}),{setProjectNotExisting:e,isProjectNotExisting:o}}(this.options.storageExpiration),this.options.pull&&console.warn('The pull API was removed use "private: true" option instead: https://docs.locize.com/integration/api#fetch-private-namespace-resources');const s="undefined"!=typeof window&&window.location&&window.location.hostname;var r,a,c,l;s?(this.isAddOrUpdateAllowed="function"==typeof this.options.allowedAddOrUpdateHosts?this.options.allowedAddOrUpdateHosts(s):this.options.allowedAddOrUpdateHosts.indexOf(s)>-1,t&&t.logger&&(o.saveMissing||o.updateMissing)&&(this.isAddOrUpdateAllowed?"localhost"!==s&&t.logger.warn(`locize-backend: you are using the save or update missings feature from this host "${s}".\nMake sure you will not use it in production!\nhttps://docs.locize.com/guides-tips-and-tricks/going-production`):t.logger.warn("function"==typeof this.options.allowedAddOrUpdateHosts?`locize-backend: will not save or update missings because allowedAddOrUpdateHosts returned false for the host "${s}".`:`locize-backend: will not save or update missings because the host "${s}" was not in the list of allowedAddOrUpdateHosts: ${this.options.allowedAddOrUpdateHosts.join(", ")} (matches need to be exact).`))):this.isAddOrUpdateAllowed=!0,"function"==typeof i&&this.getOptions((t,o)=>{if(t)return i(t);this.options.referenceLng=e.referenceLng||o.referenceLng||this.options.referenceLng,i(null,o)}),this.queuedWrites={pending:{}},this.debouncedProcess=(r=this.process,a=1e4,function(){var t=this,e=arguments,o=function(){l=null,c||r.apply(t,e)},n=c&&!l;clearTimeout(l),l=setTimeout(o,a),n&&r.apply(t,e)}),this.interval&&clearInterval(this.interval),this.options.reloadInterval&&(this.interval=setInterval(()=>this.reload(),this.options.reloadInterval))}reload(){const{backendConnector:t,languageUtils:e,logger:o}=this.services;if(!t)return;const n=t.language;if(n&&"cimode"===n.toLowerCase())return;const i=[],s=t=>{e.toResolveHierarchy(t).forEach(t=>{i.indexOf(t)<0&&i.push(t)})};s(n),this.allOptions.preload&&this.allOptions.preload.forEach(t=>s(t)),i.forEach(e=>{this.allOptions.ns.forEach(n=>{t.read(e,n,"read",null,null,(i,s)=>{i&&o.warn(`loading namespace ${n} for language ${e} failed`,i),!i&&s&&o.log(`loaded namespace ${n} for language ${e}`,s),t.loaded(`${e}|${n}`,i,s)})})})}getLanguages(t){const e=l(this.options,["projectId"]);if(e)return t(new Error(e));const o=c(this.options.getLanguagesPath,{projectId:this.options.projectId});if(!this.isProjectNotExisting&&this.storage.isProjectNotExisting(this.options.projectId)&&(this.isProjectNotExisting=!0),this.isProjectNotExisting)return t(new Error(`locize project ${this.options.projectId} does not exist!`));this.loadUrl({},o,(e,o,n)=>{if(!this.somethingLoaded&&n&&n.resourceNotExisting)return this.isProjectNotExisting=!0,this.storage.setProjectNotExisting(this.options.projectId),t(new Error(`locize project ${this.options.projectId} does not exist!`));this.somethingLoaded=!0,t(e,o)})}getOptions(t){this.getLanguages((e,o)=>{if(e)return t(e);const n=Object.keys(o);if(!n.length)return t(new Error("was unable to load languages via API"));const i=n.reduce((t,e)=>(o[e].isReferenceLanguage&&(t=e),t),""),s=n.reduce((t,e)=>{const n=o[e];return n.translated[this.options.version]&&n.translated[this.options.version]>=this.options.whitelistThreshold&&t.push(e),t},[]),r=n.reduce((t,e)=>e.indexOf("-")>-1||t,!1);t(null,{fallbackLng:i,referenceLng:i,whitelist:s,load:r?"all":"languageOnly"})})}checkIfProjectExists(t){const{logger:e}=this.services;this.somethingLoaded?t&&t(null):this.alreadyRequestedCheckIfProjectExists?setTimeout(()=>this.checkIfProjectExists(t),this.options.checkForProjectTimeout):(this.alreadyRequestedCheckIfProjectExists=!0,this.getLanguages(o=>{o&&o.message&&o.message.indexOf("does not exist")>0&&e&&e.error(o.message),t&&t(o)}))}read(t,e,o){const{logger:n}=this.services||{logger:console};let i,s={};if(this.options.private){const n=l(this.options,["projectId","version","apiKey"]);if(n)return o(new Error(n),!1);i=c(this.options.privatePath,{lng:t,ns:e,projectId:this.options.projectId,version:this.options.version}),s={authorize:!0}}else{const n=l(this.options,["projectId","version"]);if(n)return o(new Error(n),!1);i=c(this.options.loadPath,{lng:t,ns:e,projectId:this.options.projectId,version:this.options.version})}if(!this.isProjectNotExisting&&this.storage.isProjectNotExisting(this.options.projectId)&&(this.isProjectNotExisting=!0),this.isProjectNotExisting){const t=new Error(`locize project ${this.options.projectId} does not exist!`);return n&&n.error(t.message),void(o&&o(t))}this.loadUrl(s,i,(t,e,n)=>{this.somethingLoaded||(n&&n.resourceNotExisting?setTimeout(()=>this.checkIfProjectExists(),this.options.checkForProjectTimeout):this.somethingLoaded=!0),o(t,e)})}loadUrl(t,e,o,i){t=n(t,this.options),"function"==typeof o&&(i=o,o=void 0),i=i||(()=>{}),w(t,e,o,(t,o)=>{const n=o&&o.resourceNotExisting;if(o&&(408===o.status||400===o.status))return i("failed loading "+e,!0,{resourceNotExisting:n});if(o&&o.status>=500&&o.status<600)return i("failed loading "+e,!0,{resourceNotExisting:n});if(o&&o.status>=400&&o.status<500)return i("failed loading "+e,!1,{resourceNotExisting:n});if(t)return i(t,!1);let s,r;try{s=JSON.parse(o.data)}catch(t){r="failed parsing "+e+" to json"}return r?i(r,!1):this.options.failLoadingOnEmptyJSON&&!Object.keys(s).length?i("loaded result empty for "+e,!1,{resourceNotExisting:n}):void i(null,s,{resourceNotExisting:n})})}create(t,e,o,n,i,s){i||(i=()=>{}),this.checkIfProjectExists(r=>{if(r)return i(r);const a=l(this.options,["projectId","version","apiKey","referenceLng"]);return a?i(new Error(a)):this.isAddOrUpdateAllowed?("string"==typeof t&&(t=[t]),t.filter(t=>t===this.options.referenceLng).length<1&&this.services&&this.services.logger&&this.services.logger.warn(`locize-backend: will not save missings because the reference language "${this.options.referenceLng}" was not in the list of to save languages: ${t.join(", ")} (open your site in the reference language to save missings).`),void t.forEach(t=>{t===this.options.referenceLng&&this.queue.call(this,this.options.referenceLng,e,o,n,i,s)})):i("host is not allowed to create key.")})}update(t,e,o,n,i,s){i||(i=()=>{}),this.checkIfProjectExists(r=>{if(r)return i(r);const a=l(this.options,["projectId","version","apiKey","referenceLng"]);return a?i(new Error(a)):this.isAddOrUpdateAllowed?(s||(s={}),"string"==typeof t&&(t=[t]),s.isUpdate=!0,void t.forEach(t=>{t===this.options.referenceLng&&this.queue.call(this,this.options.referenceLng,e,o,n,i,s)})):i("host is not allowed to update key.")})}writePage(t,e,o,n){const i=c(this.options.addPath,{lng:t,ns:e,projectId:this.options.projectId,version:this.options.version}),s=c(this.options.updatePath,{lng:t,ns:e,projectId:this.options.projectId,version:this.options.version});let r=!1,a=!1;const l={},u={};o.forEach(t=>{const e=t.options&&t.options.tDescription?{value:t.fallbackValue||"",context:{text:t.options.tDescription}}:t.fallbackValue||"";t.options&&t.options.isUpdate?(a||(a=!0),u[t.key]=e):(r||(r=!0),l[t.key]=e)});let d=0;r&&d++,a&&d++;const p=t=>{d--,d||n(t)};d||p(),r&&w({authorize:!0,...this.options},i,l,p),a&&w({authorize:!0,...this.options},s,u,p)}write(t,e){if(r(this.queuedWrites,["locks",t,e]))return;const o=r(this.queuedWrites,[t,e]);s(this.queuedWrites,[t,e],[]);if(o.length){s(this.queuedWrites,["locks",t,e],!0);const n=()=>{s(this.queuedWrites,["locks",t,e],!1),o.forEach(t=>{t.callback&&t.callback()}),this.options.onSaved&&this.options.onSaved(t,e),this.debouncedProcess(t,e)},i=o.length/1e3;let r=0,a=o.splice(0,1e3);for(this.writePage(t,e,a,()=>{r++,r>=i&&n()});1e3===a.length;)a=o.splice(0,1e3),a.length&&this.writePage(t,e,a,()=>{r++,r>=i&&n()})}}process(){Object.keys(this.queuedWrites).forEach(t=>{"locks"!==t&&Object.keys(this.queuedWrites[t]).forEach(e=>{this.queuedWrites[t][e].length&&this.write(t,e)})})}queue(t,e,o,n,s,r){!function(t,e,o,n){const{obj:s,k:r}=i(t,e,Object);s[r]=s[r]||[],n&&(s[r]=s[r].concat(o)),n||s[r].push(o)}(this.queuedWrites,[t,e],{key:o,fallbackValue:n||"",callback:s,options:r}),this.debouncedProcess()}}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}y.type="backend";var x=[],k=x.forEach,j=x.slice;function L(t){return k.call(j.call(arguments,1),(function(e){if(e)for(var o in e)void 0===t[o]&&(t[o]=e[o])})),t}var E,O=function(t,e,o,n){var i,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/"};if(o){var r=new Date;r.setTime(r.getTime()+60*o*1e3),i="; expires="+r.toUTCString()}else i="";n=n?"domain="+n+";":"",s=Object.keys(s).reduce((function(t,e){return t+";"+e.replace(/([A-Z])/g,(function(t){return"-"+t.toLowerCase()}))+"="+s[e]}),""),document.cookie=t+"="+encodeURIComponent(e)+i+";"+n+s},I=function(t){for(var e=t+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var i=o[n];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(e))return i.substring(e.length,i.length)}return null},P={name:"cookie",lookup:function(t){var e;if(t.lookupCookie&&"undefined"!=typeof document){var o=I(t.lookupCookie);o&&(e=o)}return e},cacheUserLanguage:function(t,e){e.lookupCookie&&"undefined"!=typeof document&&O(e.lookupCookie,t,e.cookieMinutes,e.cookieDomain,e.cookieOptions)}},S={name:"querystring",lookup:function(t){var e;if("undefined"!=typeof window)for(var o=window.location.search.substring(1).split("&"),n=0;n<o.length;n++){var i=o[n].indexOf("=");if(i>0)o[n].substring(0,i)===t.lookupQuerystring&&(e=o[n].substring(i+1))}return e}};try{E="undefined"!==window&&null!==window.localStorage;window.localStorage.setItem("i18next.translate.boo","foo"),window.localStorage.removeItem("i18next.translate.boo")}catch(t){E=!1}var T={name:"localStorage",lookup:function(t){var e;if(t.lookupLocalStorage&&E){var o=window.localStorage.getItem(t.lookupLocalStorage);o&&(e=o)}return e},cacheUserLanguage:function(t,e){e.lookupLocalStorage&&E&&window.localStorage.setItem(e.lookupLocalStorage,t)}},A={name:"navigator",lookup:function(t){var e=[];if("undefined"!=typeof navigator){if(navigator.languages)for(var o=0;o<navigator.languages.length;o++)e.push(navigator.languages[o]);navigator.userLanguage&&e.push(navigator.userLanguage),navigator.language&&e.push(navigator.language)}return e.length>0?e:void 0}},N={name:"htmlTag",lookup:function(t){var e,o=t.htmlTag||("undefined"!=typeof document?document.documentElement:null);return o&&"function"==typeof o.getAttribute&&(e=o.getAttribute("lang")),e}},q={name:"path",lookup:function(t){var e;if("undefined"!=typeof window){var o=window.location.pathname.match(/\/([a-zA-Z-]*)/g);if(o instanceof Array)if("number"==typeof t.lookupFromPathIndex){if("string"!=typeof o[t.lookupFromPathIndex])return;e=o[t.lookupFromPathIndex].replace("/","")}else e=o[0].replace("/","")}return e}},z={name:"subdomain",lookup:function(t){var e;if("undefined"!=typeof window){var o=window.location.href.match(/(?:http[s]*\:\/\/)*(.*?)\.(?=[^\/]*\..{2,5})/gi);o instanceof Array&&(e="number"==typeof t.lookupFromSubdomainIndex?o[t.lookupFromSubdomainIndex].replace("http://","").replace("https://","").replace(".",""):o[0].replace("http://","").replace("https://","").replace(".",""))}return e}};var H,U=function(){function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};m(this,t),this.type="languageDetector",this.detectors={},this.init(e,o)}var e,o,n;return e=t,(o=[{key:"init",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=t,this.options=L(e,this.options||{},{order:["querystring","cookie","localStorage","navigator","htmlTag"],lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],checkWhitelist:!0}),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=o,this.addDetector(P),this.addDetector(S),this.addDetector(T),this.addDetector(A),this.addDetector(N),this.addDetector(q),this.addDetector(z)}},{key:"addDetector",value:function(t){this.detectors[t.name]=t}},{key:"detect",value:function(t){var e=this;t||(t=this.options.order);var o,n=[];if(t.forEach((function(t){if(e.detectors[t]){var o=e.detectors[t].lookup(e.options);o&&"string"==typeof o&&(o=[o]),o&&(n=n.concat(o))}})),n.forEach((function(t){if(!o){var n=e.services.languageUtils.formatLanguageCode(t);e.options.checkWhitelist&&!e.services.languageUtils.isWhitelisted(n)||(o=n)}})),!o){var i=this.i18nOptions.fallbackLng;"string"==typeof i&&(i=[i]),i||(i=[]),o="[object Array]"===Object.prototype.toString.apply(i)?i[0]:i[0]||i.default&&i.default[0]}return o}},{key:"cacheUserLanguage",value:function(t,e){var o=this;e||(e=this.options.caches),e&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(t)>-1||e.forEach((function(e){o.detectors[e]&&o.detectors[e].cacheUserLanguage(t,o.options)})))}}])&&b(e.prototype,o),n&&b(e,n),t}();if(U.type="languageDetector","function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?H=global.fetch:"undefined"!=typeof window&&window.fetch&&(H=window.fetch)),"undefined"!=typeof require){var R=H||require("node-fetch");R.default&&(R=R.default),exports.default=R,module.exports=exports.default}var $=Object.freeze({__proto__:null});let C,X,D;"function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?C=global.fetch:"undefined"!=typeof window&&window.fetch&&(C=window.fetch)),"function"==typeof XMLHttpRequest&&("undefined"!=typeof global&&global.XMLHttpRequest?X=global.XMLHttpRequest:"undefined"!=typeof window&&window.XMLHttpRequest&&(X=window.XMLHttpRequest)),"function"==typeof ActiveXObject&&("undefined"!=typeof global&&global.ActiveXObject?D=global.ActiveXObject:"undefined"!=typeof window&&window.ActiveXObject&&(D=window.ActiveXObject)),!C&&$&&(C=$);const M=(t,e,o,n)=>("function"==typeof o&&(n=o,o=void 0),n=n||(()=>{}),C?((t,e,o,n)=>{C(e,{method:o?"POST":"GET",body:o?JSON.stringify(o):void 0,headers:{Authorization:t.authorize&&t.apiKey?t.apiKey:void 0,"Content-Type":"application/json"}}).then(t=>{const e=t.headers&&"Error from cloudfront"===t.headers.get("x-cache");if(!t.ok)return n(t.statusText||"Error",{status:t.status,resourceNotExisting:e});t.text().then(o=>{n(null,{status:t.status,data:o,resourceNotExisting:e})}).catch(n)}).catch(n)})(t,e,o,n):"function"==typeof XMLHttpRequest||"function"==typeof ActiveXObject?((t,e,o,n)=>{try{let i;i=X?new X:new D("MSXML2.XMLHTTP.3.0"),i.open(o?"POST":"GET",e,1),t.crossDomain||i.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.authorize&&t.apiKey&&i.setRequestHeader("Authorization",t.apiKey),(o||t.setContentTypeJSON)&&i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=()=>{const t="Error from cloudfront"===i.getResponseHeader("x-cache");i.readyState>3&&n(i.statusText,{status:i.status,data:i.responseText,resourceNotExisting:t})},i.send(JSON.stringify(o))}catch(t){console&&console.log(t)}})(t,e,o,n):void 0),W={init(t){const e=t.t&&"function"==typeof t.t;this.options=e?{lastUsedPath:"https://api.locize.app/used/{{projectId}}/{{version}}/{{lng}}/{{ns}}",referenceLng:"en",crossDomain:!0,setContentTypeJSON:!1,version:"latest",debounceSubmit:9e4,allowedHosts:["localhost"],...this.options,...t.options.locizeLastUsed}:{lastUsedPath:"https://api.locize.app/used/{{projectId}}/{{version}}/{{lng}}/{{ns}}",referenceLng:"en",crossDomain:!0,setContentTypeJSON:!1,version:"latest",debounceSubmit:9e4,allowedHosts:["localhost"],...this.options,...t};const o="undefined"!=typeof window&&window.location&&window.location.hostname;var n,i,s,r;this.isAllowed=!o||this.options.allowedHosts.indexOf(o)>-1,this.submitting=null,this.pending={},this.done={},this.submit=(n=this.submit,i=this.options.debounceSubmit,function(){var t=this,e=arguments,o=function(){r=null,s||n.apply(t,e)},a=s&&!r;clearTimeout(r),r=setTimeout(o,i),a&&n.apply(t,e)}),e&&this.interceptI18next(t)},interceptI18next(t){const e=t.services.resourceStore.getResource;t.services.resourceStore.getResource=(o,n,i,s)=>(i&&this.used(n,i),e.call(t.services.resourceStore,o,n,i,s))},used(t,e,o){["pending","done"].forEach(o=>{this.done[t]&&this.done[t][e]||(this[o][t]||(this[o][t]={}),this[o][t][e]=!0)}),this.submit(o)},submit(t){if(!this.isAllowed)return t&&t(new Error("not allowed"));if(this.submitting)return this.submit(t);const e=(o=this.options,["projectId","version","apiKey","referenceLng"].reduce((t,e)=>{if(t)return t;if(!o||!o[e]||"string"!=typeof o[e]||!o[e].toLowerCase()===e.toLowerCase()){const t=`i18next-lastused :: got "${o[e]}" in options for ${e} which is invalid.`;return console.warn(t),t}return!1},!1));var o;if(e)return t&&t(new Error(e));this.submitting=this.pending,this.pending={};const n=Object.keys(this.submitting);let i=n.length;const s=e=>{i--,i||(this.submitting=null,t&&t(e))};n.forEach(t=>{const e=Object.keys(this.submitting[t]),o=function(t,e,o){let n=t;return e.forEach(t=>{const e=new RegExp(`{{${t}}}`,"g");n=n.replace(e,o[t])}),n}(this.options.lastUsedPath,["projectId","version","lng","ns"],{...this.options,lng:this.options.referenceLng,ns:t});e.length?M({authorize:!0,...this.options},o,e,s):s()})},type:"3rdParty"};var F=new RegExp("{{(.+?)}}","g");function _(t){if(t.indexOf("-")<0)return t;var e=t.split("-");return["NB-NO","NN-NO","nb-NO","nn-NO","nb-no","nn-no"].indexOf(t)>-1?e[1].toLowerCase():e[0]}var J={interpolator:{interpolate:function(t,e,o){for(var n,i,s;n=F.exec(t);)"string"!=typeof(i=n[1].trim())&&(i=null==(s=i)?"":""+s),i||(i=""),i=i.replace(/\$/g,"$$$$"),t=t.replace(n[0],e[i]||i),F.lastIndex=0;return t}},languageUtils:{formatLanguageCode:function(t){return t},isWhitelisted:function(t){return!0}}};return{init:function(t){return this.options=t,this.backend=new y(J,t),this.detector=new U(J,t),this.lng=t.lng||this.detector.detect(),W.init(t),this},getLanguage:function(t,e){var o=this;"function"==typeof t&&(e=t,t=this.lng),t||(t=this.lng);var n=function(t,e){return t[e]&&t[e].translated[o.options.version||"latest"]>=(o.options.loadIfTranslatedOver||1)};return this.getLanguages((function(i,s){return n(s,t)?e(null,t):n(s,_(t))?e(null,_(t)):void e(null,o.options.fallbackLng||Object.keys(s)[0])})),this},getLanguages:function(t){var e=this;return this.publishedLngs?t(null,this.publishedLngs):this.backend.getLanguages((function(o,n){o||(e.publishedLngs=n),t(null,n)})),this},load:function(t,e,o){var n=this;return"function"==typeof e&&(o=e,e=null),this.getLanguage(e,(function(e,i){n.backend.read(i,t,(function(t,e){return o(t,e,i)}))})),this},add:function(t,e,o,n,i){var s={};return"function"==typeof n?i=n:"string"==typeof n&&(s.tDescription=n),this.backend.create(this.options.referenceLng,t,e,o,i,s),this},update:function(t,e,o,n,i){var s={isUpdate:!0};return"function"==typeof n?i=n:"string"==typeof n&&(s.tDescription=n),this.backend.create(this.options.referenceLng,t,e,o,i,s),this},used:function(t,e){W.used(t,e)}}}));

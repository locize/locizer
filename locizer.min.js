!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).locizer=t()}(this,(function(){"use strict";const e=[],t=e.forEach,o=e.slice;function n(e){return t.call(o.call(arguments,1),t=>{if(t)for(var o in t)void 0===e[o]&&(e[o]=t[o])}),e}function i(e,t,o){function n(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}const i="string"!=typeof t?[].concat(t):t.split(".");for(;i.length>1;){if(!e)return{};const t=n(i.shift());!e[t]&&o&&(e[t]=new o),e=e[t]}return e?{obj:e,k:n(i.shift())}:{}}function s(e,t,o){const{obj:n,k:s}=i(e,t,Object);n[s]=o}function r(e,t){const{obj:o,k:n}=i(e,t);if(o)return o[n]}const a=new RegExp("{{(.+?)}}","g");function c(e,t,o){let n,i;for(;n=a.exec(e);)i=n[1].trim(),"string"!=typeof i&&(i=null==(s=i)?"":""+s),i||(i=""),i=i.replace(/\$/g,"$$$$"),e=e.replace(n[0],t[i]||i),a.lastIndex=0;var s;return e}function l(e,t){return t.reduce((t,o)=>{if(t)return t;if(!e||!e[o]||"string"!=typeof e[o]||!e[o].toLowerCase()===o.toLowerCase()){const t=`i18next-locize-backend :: got "${e[o]}" in options for ${o} which is invalid.`;return console.warn(t),t}return!1},!1)}var u;if("function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?u=global.fetch:"undefined"!=typeof window&&window.fetch&&(u=window.fetch)),"undefined"!=typeof require&&("undefined"==typeof window||void 0===window.document)){var d=u||require("node-fetch");d.default&&(d=d.default),exports.default=d,module.exports=exports.default}var h=Object.freeze({__proto__:null});let p,f,g;"function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?p=global.fetch:"undefined"!=typeof window&&window.fetch&&(p=window.fetch)),"function"==typeof XMLHttpRequest&&("undefined"!=typeof global&&global.XMLHttpRequest?f=global.XMLHttpRequest:"undefined"!=typeof window&&window.XMLHttpRequest&&(f=window.XMLHttpRequest)),"function"==typeof ActiveXObject&&("undefined"!=typeof global&&global.ActiveXObject?g=global.ActiveXObject:"undefined"!=typeof window&&window.ActiveXObject&&(g=window.ActiveXObject)),p||!h||f||g||(p=h),"function"!=typeof p&&(p=void 0);const w=(e,t,o,n)=>("function"==typeof o&&(n=o,o=void 0),n=n||(()=>{}),p?((e,t,o,n)=>{p(t,{method:o?"POST":"GET",body:o?JSON.stringify(o):void 0,headers:{Authorization:e.authorize&&e.apiKey?e.apiKey:void 0,"Content-Type":"application/json"}}).then(e=>{const t=e.headers&&"Error from cloudfront"===e.headers.get("x-cache");if(!e.ok)return n(e.statusText||"Error",{status:e.status,resourceNotExisting:t});e.text().then(o=>{n(null,{status:e.status,data:o,resourceNotExisting:t})}).catch(n)}).catch(n)})(e,t,o,n):"function"==typeof XMLHttpRequest||"function"==typeof ActiveXObject?((e,t,o,n)=>{try{let i;i=f?new f:new g("MSXML2.XMLHTTP.3.0"),i.open(o?"POST":"GET",t,1),e.crossDomain||i.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.authorize&&e.apiKey&&i.setRequestHeader("Authorization",e.apiKey),(o||e.setContentTypeJSON)&&i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=()=>{const e="Error from cloudfront"===i.getResponseHeader("x-cache");i.readyState>3&&n(i.status>=400?i.statusText:null,{status:i.status,data:i.responseText,resourceNotExisting:e})},i.send(JSON.stringify(o))}catch(e){console&&console.log(e)}})(e,t,o,n):void 0);let v;try{v="undefined"!=typeof window&&null!==window.localStorage;const e="notExistingLocizeProject";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch(e){v=!1}class y{constructor(e,t={},o={},n){this.services=e,this.options=t,this.allOptions=o,this.type="backend",e&&e.projectId?this.init(null,e,o,t):this.init(e,t,o,n)}init(e,t={},o={},i){this.services=e,void 0!==t.whitelistThreshold&&void 0===t.translatedPercentageThreshold&&(e&&e.logger&&e.logger.deprecate("whitelistThreshold",'option "whitelistThreshold" will be renamed to "translatedPercentageThreshold" in the next major - please make sure to rename this option asap.'),t.translatedPercentageThreshold=t.whitelistThreshold),this.options=n(t,this.options||{},{loadPath:"https://api.locize.app/{{projectId}}/{{version}}/{{lng}}/{{ns}}",privatePath:"https://api.locize.app/private/{{projectId}}/{{version}}/{{lng}}/{{ns}}",getLanguagesPath:"https://api.locize.app/languages/{{projectId}}",addPath:"https://api.locize.app/missing/{{projectId}}/{{version}}/{{lng}}/{{ns}}",updatePath:"https://api.locize.app/update/{{projectId}}/{{version}}/{{lng}}/{{ns}}",referenceLng:"en",crossDomain:!0,setContentTypeJSON:!1,version:"latest",private:!1,translatedPercentageThreshold:.9,whitelistThreshold:.9,failLoadingOnEmptyJSON:!1,allowedAddOrUpdateHosts:["localhost"],onSaved:!1,reloadInterval:36e5,checkForProjectTimeout:3e3,storageExpiration:36e5}),this.allOptions=o,this.somethingLoaded=!1,this.isProjectNotExisting=!1,this.storage=function(e){let t=()=>{},o=()=>{};return v?(t=e=>{window.localStorage.setItem("notExistingLocizeProject_"+e,Date.now())},o=t=>{const o=window.localStorage.getItem("notExistingLocizeProject_"+t);return!!o&&(!(Date.now()-o>e)||(window.localStorage.removeItem("notExistingLocizeProject_"+t),!1))}):"undefined"!=typeof document&&(t=t=>{const o=new Date;o.setTime(o.getTime()+e);const n="; expires="+o.toGMTString(),i="notExistingLocizeProject_"+t;document.cookie=`${i}=${Date.now()}${n};path=/`},o=e=>{const t="notExistingLocizeProject_"+e+"=",o=document.cookie.split(";");for(let e=0;e<o.length;e++){let n=o[e];for(;" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return!0}return!1}),{setProjectNotExisting:t,isProjectNotExisting:o}}(this.options.storageExpiration),this.options.pull&&console.warn('The pull API was removed use "private: true" option instead: https://docs.locize.com/integration/api#fetch-private-namespace-resources');const s="undefined"!=typeof window&&window.location&&window.location.hostname;var r,a,c,l;s?(this.isAddOrUpdateAllowed="function"==typeof this.options.allowedAddOrUpdateHosts?this.options.allowedAddOrUpdateHosts(s):this.options.allowedAddOrUpdateHosts.indexOf(s)>-1,e&&e.logger&&(o.saveMissing||o.updateMissing)&&(this.isAddOrUpdateAllowed?"localhost"!==s&&e.logger.warn(`locize-backend: you are using the save or update missings feature from this host "${s}".\nMake sure you will not use it in production!\nhttps://docs.locize.com/guides-tips-and-tricks/going-production`):e.logger.warn("function"==typeof this.options.allowedAddOrUpdateHosts?`locize-backend: will not save or update missings because allowedAddOrUpdateHosts returned false for the host "${s}".`:`locize-backend: will not save or update missings because the host "${s}" was not in the list of allowedAddOrUpdateHosts: ${this.options.allowedAddOrUpdateHosts.join(", ")} (matches need to be exact).`))):this.isAddOrUpdateAllowed=!0,"function"==typeof i&&this.getOptions((e,o)=>{if(e)return i(e);this.options.referenceLng=t.referenceLng||o.referenceLng||this.options.referenceLng,i(null,o)}),this.queuedWrites={pending:{}},this.debouncedProcess=(r=this.process,a=1e4,function(){var e=this,t=arguments,o=function(){l=null,c||r.apply(e,t)},n=c&&!l;clearTimeout(l),l=setTimeout(o,a),n&&r.apply(e,t)}),this.interval&&clearInterval(this.interval),this.options.reloadInterval&&(this.interval=setInterval(()=>this.reload(),this.options.reloadInterval))}reload(){const{backendConnector:e,languageUtils:t,logger:o}=this.services;if(!e)return;const n=e.language;if(n&&"cimode"===n.toLowerCase())return;const i=[],s=e=>{t.toResolveHierarchy(e).forEach(e=>{i.indexOf(e)<0&&i.push(e)})};s(n),this.allOptions.preload&&this.allOptions.preload.forEach(e=>s(e)),i.forEach(t=>{this.allOptions.ns.forEach(n=>{e.read(t,n,"read",null,null,(i,s)=>{i&&o.warn(`loading namespace ${n} for language ${t} failed`,i),!i&&s&&o.log(`loaded namespace ${n} for language ${t}`,s),e.loaded(`${t}|${n}`,i,s)})})})}getLanguages(e){const t=l(this.options,["projectId"]);if(t)return e(new Error(t));const o=c(this.options.getLanguagesPath,{projectId:this.options.projectId});if(!this.isProjectNotExisting&&this.storage.isProjectNotExisting(this.options.projectId)&&(this.isProjectNotExisting=!0),this.isProjectNotExisting)return e(new Error(`locize project ${this.options.projectId} does not exist!`));this.loadUrl({},o,(t,o,n)=>{if(!this.somethingLoaded&&n&&n.resourceNotExisting)return this.isProjectNotExisting=!0,this.storage.setProjectNotExisting(this.options.projectId),e(new Error(`locize project ${this.options.projectId} does not exist!`));this.somethingLoaded=!0,e(t,o)})}getOptions(e){this.getLanguages((t,o)=>{if(t)return e(t);const n=Object.keys(o);if(!n.length)return e(new Error("was unable to load languages via API"));const i=n.reduce((e,t)=>(o[t].isReferenceLanguage&&(e=t),e),""),s=n.reduce((e,t)=>{const n=o[t];return n.translated[this.options.version]&&n.translated[this.options.version]>=this.options.translatedPercentageThreshold&&e.push(t),e},[]),r=n.reduce((e,t)=>t.indexOf("-")>-1||e,!1);e(null,{fallbackLng:i,referenceLng:i,supportedLngs:s,whitelist:s,load:r?"all":"languageOnly"})})}checkIfProjectExists(e){const{logger:t}=this.services;this.somethingLoaded?e&&e(null):this.alreadyRequestedCheckIfProjectExists?setTimeout(()=>this.checkIfProjectExists(e),this.options.checkForProjectTimeout):(this.alreadyRequestedCheckIfProjectExists=!0,this.getLanguages(o=>{o&&o.message&&o.message.indexOf("does not exist")>0&&t&&t.error(o.message),e&&e(o)}))}read(e,t,o){const{logger:n}=this.services||{logger:console};let i,s={};if(this.options.private){const n=l(this.options,["projectId","version","apiKey"]);if(n)return o(new Error(n),!1);i=c(this.options.privatePath,{lng:e,ns:t,projectId:this.options.projectId,version:this.options.version}),s={authorize:!0}}else{const n=l(this.options,["projectId","version"]);if(n)return o(new Error(n),!1);i=c(this.options.loadPath,{lng:e,ns:t,projectId:this.options.projectId,version:this.options.version})}if(!this.isProjectNotExisting&&this.storage.isProjectNotExisting(this.options.projectId)&&(this.isProjectNotExisting=!0),this.isProjectNotExisting){const e=new Error(`locize project ${this.options.projectId} does not exist!`);return n&&n.error(e.message),void(o&&o(e))}this.loadUrl(s,i,(e,t,n)=>{this.somethingLoaded||(n&&n.resourceNotExisting?setTimeout(()=>this.checkIfProjectExists(),this.options.checkForProjectTimeout):this.somethingLoaded=!0),o(e,t)})}loadUrl(e,t,o,i){e=n(e,this.options),"function"==typeof o&&(i=o,o=void 0),i=i||(()=>{}),w(e,t,o,(e,o)=>{const n=o&&o.resourceNotExisting;if(o&&(408===o.status||400===o.status))return i("failed loading "+t,!0,{resourceNotExisting:n});if(o&&o.status>=500&&o.status<600)return i("failed loading "+t,!0,{resourceNotExisting:n});if(o&&o.status>=400&&o.status<500)return i("failed loading "+t,!1,{resourceNotExisting:n});if(e)return i(e,!1);let s,r;try{s=JSON.parse(o.data)}catch(e){r="failed parsing "+t+" to json"}return r?i(r,!1):this.options.failLoadingOnEmptyJSON&&!Object.keys(s).length?i("loaded result empty for "+t,!1,{resourceNotExisting:n}):void i(null,s,{resourceNotExisting:n})})}create(e,t,o,n,i,s){i||(i=()=>{}),this.checkIfProjectExists(r=>{if(r)return i(r);const a=l(this.options,["projectId","version","apiKey","referenceLng"]);return a?i(new Error(a)):this.isAddOrUpdateAllowed?("string"==typeof e&&(e=[e]),e.filter(e=>e===this.options.referenceLng).length<1&&this.services&&this.services.logger&&this.services.logger.warn(`locize-backend: will not save missings because the reference language "${this.options.referenceLng}" was not in the list of to save languages: ${e.join(", ")} (open your site in the reference language to save missings).`),void e.forEach(e=>{e===this.options.referenceLng&&this.queue.call(this,this.options.referenceLng,t,o,n,i,s)})):i("host is not allowed to create key.")})}update(e,t,o,n,i,s){i||(i=()=>{}),this.checkIfProjectExists(r=>{if(r)return i(r);const a=l(this.options,["projectId","version","apiKey","referenceLng"]);return a?i(new Error(a)):this.isAddOrUpdateAllowed?(s||(s={}),"string"==typeof e&&(e=[e]),s.isUpdate=!0,void e.forEach(e=>{e===this.options.referenceLng&&this.queue.call(this,this.options.referenceLng,t,o,n,i,s)})):i("host is not allowed to update key.")})}writePage(e,t,o,i){const s=c(this.options.addPath,{lng:e,ns:t,projectId:this.options.projectId,version:this.options.version}),r=c(this.options.updatePath,{lng:e,ns:t,projectId:this.options.projectId,version:this.options.version});let a=!1,l=!1;const u={},d={};o.forEach(e=>{const t=e.options&&e.options.tDescription?{value:e.fallbackValue||"",context:{text:e.options.tDescription}}:e.fallbackValue||"";e.options&&e.options.isUpdate?(l||(l=!0),d[e.key]=t):(a||(a=!0),u[e.key]=t)});let h=0;a&&h++,l&&h++;const p=e=>{h--,h||i(e)};h||p(),a&&w(n({authorize:!0},this.options),s,u,p),l&&w(n({authorize:!0},this.options),r,d,p)}write(e,t){if(r(this.queuedWrites,["locks",e,t]))return;const o=r(this.queuedWrites,[e,t]);s(this.queuedWrites,[e,t],[]);if(o.length){s(this.queuedWrites,["locks",e,t],!0);const n=()=>{s(this.queuedWrites,["locks",e,t],!1),o.forEach(e=>{e.callback&&e.callback()}),this.options.onSaved&&this.options.onSaved(e,t),this.debouncedProcess(e,t)},i=o.length/1e3;let r=0,a=o.splice(0,1e3);for(this.writePage(e,t,a,()=>{r++,r>=i&&n()});1e3===a.length;)a=o.splice(0,1e3),a.length&&this.writePage(e,t,a,()=>{r++,r>=i&&n()})}}process(){Object.keys(this.queuedWrites).forEach(e=>{"locks"!==e&&Object.keys(this.queuedWrites[e]).forEach(t=>{this.queuedWrites[e][t].length&&this.write(e,t)})})}queue(e,t,o,n,s,r){!function(e,t,o,n){const{obj:s,k:r}=i(e,t,Object);s[r]=s[r]||[],n&&(s[r]=s[r].concat(o)),n||s[r].push(o)}(this.queuedWrites,[e,t],{key:o,fallbackValue:n||"",callback:s,options:r}),this.debouncedProcess()}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}y.type="backend";var x=[],k=x.forEach,j=x.slice;function L(e){return k.call(j.call(arguments,1),(function(t){if(t)for(var o in t)void 0===e[o]&&(e[o]=t[o])})),e}var E,O=function(e,t,o,n){var i,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/"};if(o){var r=new Date;r.setTime(r.getTime()+60*o*1e3),i="; expires="+r.toUTCString()}else i="";n=n?"domain="+n+";":"",s=Object.keys(s).reduce((function(e,t){return e+";"+t.replace(/([A-Z])/g,(function(e){return"-"+e.toLowerCase()}))+"="+s[t]}),""),document.cookie=e+"="+encodeURIComponent(t)+i+";"+n+s},I=function(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var i=o[n];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null},P={name:"cookie",lookup:function(e){var t;if(e.lookupCookie&&"undefined"!=typeof document){var o=I(e.lookupCookie);o&&(t=o)}return t},cacheUserLanguage:function(e,t){t.lookupCookie&&"undefined"!=typeof document&&O(t.lookupCookie,e,t.cookieMinutes,t.cookieDomain,t.cookieOptions)}},S={name:"querystring",lookup:function(e){var t;if("undefined"!=typeof window)for(var o=window.location.search.substring(1).split("&"),n=0;n<o.length;n++){var i=o[n].indexOf("=");if(i>0)o[n].substring(0,i)===e.lookupQuerystring&&(t=o[n].substring(i+1))}return t}};try{E="undefined"!==window&&null!==window.localStorage;window.localStorage.setItem("i18next.translate.boo","foo"),window.localStorage.removeItem("i18next.translate.boo")}catch(e){E=!1}var T,A={name:"localStorage",lookup:function(e){var t;if(e.lookupLocalStorage&&E){var o=window.localStorage.getItem(e.lookupLocalStorage);o&&(t=o)}return t},cacheUserLanguage:function(e,t){t.lookupLocalStorage&&E&&window.localStorage.setItem(t.lookupLocalStorage,e)}};try{T="undefined"!==window&&null!==window.sessionStorage;window.sessionStorage.setItem("i18next.translate.boo","foo"),window.sessionStorage.removeItem("i18next.translate.boo")}catch(e){T=!1}var N={name:"sessionStorage",lookup:function(e){var t;if(e.lookupsessionStorage&&T){var o=window.sessionStorage.getItem(e.lookupsessionStorage);o&&(t=o)}return t},cacheUserLanguage:function(e,t){t.lookupsessionStorage&&T&&window.sessionStorage.setItem(t.lookupsessionStorage,e)}},q={name:"navigator",lookup:function(e){var t=[];if("undefined"!=typeof navigator){if(navigator.languages)for(var o=0;o<navigator.languages.length;o++)t.push(navigator.languages[o]);navigator.userLanguage&&t.push(navigator.userLanguage),navigator.language&&t.push(navigator.language)}return t.length>0?t:void 0}},z={name:"htmlTag",lookup:function(e){var t,o=e.htmlTag||("undefined"!=typeof document?document.documentElement:null);return o&&"function"==typeof o.getAttribute&&(t=o.getAttribute("lang")),t}},H={name:"path",lookup:function(e){var t;if("undefined"!=typeof window){var o=window.location.pathname.match(/\/([a-zA-Z-]*)/g);if(o instanceof Array)if("number"==typeof e.lookupFromPathIndex){if("string"!=typeof o[e.lookupFromPathIndex])return;t=o[e.lookupFromPathIndex].replace("/","")}else t=o[0].replace("/","")}return t}},R={name:"subdomain",lookup:function(e){var t;if("undefined"!=typeof window){var o=window.location.href.match(/(?:http[s]*\:\/\/)*(.*?)\.(?=[^\/]*\..{2,5})/gi);o instanceof Array&&(t="number"==typeof e.lookupFromSubdomainIndex?o[e.lookupFromSubdomainIndex].replace("http://","").replace("https://","").replace(".",""):o[0].replace("http://","").replace("https://","").replace(".",""))}return t}};var U=function(){function e(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};m(this,e),this.type="languageDetector",this.detectors={},this.init(t,o)}var t,o,n;return t=e,(o=[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e,this.options=L(t,this.options||{},{order:["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"],lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"]}),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=o,this.addDetector(P),this.addDetector(S),this.addDetector(A),this.addDetector(N),this.addDetector(q),this.addDetector(z),this.addDetector(H),this.addDetector(R)}},{key:"addDetector",value:function(e){this.detectors[e.name]=e}},{key:"detect",value:function(e){var t=this;e||(e=this.options.order);var o=[];return e.forEach((function(e){if(t.detectors[e]){var n=t.detectors[e].lookup(t.options);n&&"string"==typeof n&&(n=[n]),n&&(o=o.concat(n))}})),this.services.languageUtils.getBestMatchFromCodes?o:o.length>0?o[0]:null}},{key:"cacheUserLanguage",value:function(e,t){var o=this;t||(t=this.options.caches),t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach((function(t){o.detectors[t]&&o.detectors[t].cacheUserLanguage(e,o.options)})))}}])&&b(t.prototype,o),n&&b(t,n),e}();U.type="languageDetector";const $=[],X=$.forEach,C=$.slice;function M(e){return X.call(C.call(arguments,1),t=>{if(t)for(var o in t)void 0===e[o]&&(e[o]=t[o])}),e}var D;if("function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?D=global.fetch:"undefined"!=typeof window&&window.fetch&&(D=window.fetch)),"undefined"!=typeof require&&("undefined"==typeof window||void 0===window.document)){var F=D||require("node-fetch");F.default&&(F=F.default),exports.default=F,module.exports=exports.default}var _=Object.freeze({__proto__:null});let K,W,J;"function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?K=global.fetch:"undefined"!=typeof window&&window.fetch&&(K=window.fetch)),"function"==typeof XMLHttpRequest&&("undefined"!=typeof global&&global.XMLHttpRequest?W=global.XMLHttpRequest:"undefined"!=typeof window&&window.XMLHttpRequest&&(W=window.XMLHttpRequest)),"function"==typeof ActiveXObject&&("undefined"!=typeof global&&global.ActiveXObject?J=global.ActiveXObject:"undefined"!=typeof window&&window.ActiveXObject&&(J=window.ActiveXObject)),K||!_||W||J||(K=_),"function"!=typeof K&&(K=void 0);const G=(e,t,o,n)=>("function"==typeof o&&(n=o,o=void 0),n=n||(()=>{}),K?((e,t,o,n)=>{K(t,{method:o?"POST":"GET",body:o?JSON.stringify(o):void 0,headers:{Authorization:e.authorize&&e.apiKey?e.apiKey:void 0,"Content-Type":"application/json"}}).then(e=>{const t=e.headers&&"Error from cloudfront"===e.headers.get("x-cache");if(!e.ok)return n(e.statusText||"Error",{status:e.status,resourceNotExisting:t});e.text().then(o=>{n(null,{status:e.status,data:o,resourceNotExisting:t})}).catch(n)}).catch(n)})(e,t,o,n):"function"==typeof XMLHttpRequest||"function"==typeof ActiveXObject?((e,t,o,n)=>{try{let i;i=W?new W:new J("MSXML2.XMLHTTP.3.0"),i.open(o?"POST":"GET",t,1),e.crossDomain||i.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.authorize&&e.apiKey&&i.setRequestHeader("Authorization",e.apiKey),(o||e.setContentTypeJSON)&&i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=()=>{const e="Error from cloudfront"===i.getResponseHeader("x-cache");i.readyState>3&&n(i.status>=400?i.statusText:null,{status:i.status,data:i.responseText,resourceNotExisting:e})},i.send(JSON.stringify(o))}catch(e){console&&console.log(e)}})(e,t,o,n):void 0),V={init(e){const t=e.t&&"function"==typeof e.t;this.options=M(t?e.options.locizeLastUsed:e,this.options||{},{lastUsedPath:"https://api.locize.app/used/{{projectId}}/{{version}}/{{lng}}/{{ns}}",referenceLng:"en",crossDomain:!0,setContentTypeJSON:!1,version:"latest",debounceSubmit:9e4,allowedHosts:["localhost"]});const o="undefined"!=typeof window&&window.location&&window.location.hostname;var n,i,s,r;this.isAllowed=!o||this.options.allowedHosts.indexOf(o)>-1,this.submitting=null,this.pending={},this.done={},this.submit=(n=this.submit,i=this.options.debounceSubmit,function(){var e=this,t=arguments,o=function(){r=null,s||n.apply(e,t)},a=s&&!r;clearTimeout(r),r=setTimeout(o,i),a&&n.apply(e,t)}),t&&this.interceptI18next(e)},interceptI18next(e){const t=e.services.resourceStore.getResource;e.services.resourceStore.getResource=(o,n,i,s)=>(i&&this.used(n,i),t.call(e.services.resourceStore,o,n,i,s))},used(e,t,o){["pending","done"].forEach(o=>{this.done[e]&&this.done[e][t]||(this[o][e]||(this[o][e]={}),this[o][e][t]=!0)}),this.submit(o)},submit(e){if(!this.isAllowed)return e&&e(new Error("not allowed"));if(this.submitting)return this.submit(e);const t=(o=this.options,["projectId","version","apiKey","referenceLng"].reduce((e,t)=>{if(e)return e;if(!o||!o[t]||"string"!=typeof o[t]||!o[t].toLowerCase()===t.toLowerCase()){const e=`i18next-lastused :: got "${o[t]}" in options for ${t} which is invalid.`;return console.warn(e),e}return!1},!1));var o;if(t)return e&&e(new Error(t));this.submitting=this.pending,this.pending={};const n=Object.keys(this.submitting);let i=n.length;const s=t=>{i--,i||(this.submitting=null,e&&e(t))};n.forEach(e=>{const t=Object.keys(this.submitting[e]),o=function(e,t,o){let n=e;return t.forEach(e=>{const t=new RegExp(`{{${e}}}`,"g");n=n.replace(t,o[e])}),n}(this.options.lastUsedPath,["projectId","version","lng","ns"],M({lng:this.options.referenceLng,ns:e},this.options));t.length?G(M({authorize:!0},this.options),o,t,s):s()})},type:"3rdParty"};var B=new RegExp("{{(.+?)}}","g");function Q(e){if(e.indexOf("-")<0)return e;var t=e.split("-");return["NB-NO","NN-NO","nb-NO","nn-NO","nb-no","nn-no"].indexOf(e)>-1?t[1].toLowerCase():t[0]}var Z={interpolator:{interpolate:function(e,t,o){for(var n,i,s;n=B.exec(e);)"string"!=typeof(i=n[1].trim())&&(i=null==(s=i)?"":""+s),i||(i=""),i=i.replace(/\$/g,"$$$$"),e=e.replace(n[0],t[i]||i),B.lastIndex=0;return e}},languageUtils:{formatLanguageCode:function(e){return e}}};return{init:function(e){return this.options=e,this.backend=new y(Z,e),this.detector=new U(Z,e),this.lng=e.lng||this.detector.detect(),V.init(e),this},getLanguage:function(e,t){var o=this;"function"==typeof e&&(t=e,e=this.lng),e||(e=this.lng);var n=function(e,t){return e[t]&&e[t].translated[o.options.version||"latest"]>=(o.options.loadIfTranslatedOver||1)};return this.getLanguages((function(i,s){return n(s,e)?t(null,e):n(s,Q(e))?t(null,Q(e)):void t(null,o.options.fallbackLng||Object.keys(s)[0])})),this},getLanguages:function(e){var t=this;return this.publishedLngs?e(null,this.publishedLngs):this.backend.getLanguages((function(o,n){o||(t.publishedLngs=n),e(null,n)})),this},load:function(e,t,o){var n=this;return"function"==typeof t&&(o=t,t=null),this.getLanguage(t,(function(t,i){n.backend.read(i,e,(function(e,t){return o(e,t,i)}))})),this},add:function(e,t,o,n,i){var s={};return"function"==typeof n?i=n:"string"==typeof n&&(s.tDescription=n),this.backend.create(this.options.referenceLng,e,t,o,i,s),this},update:function(e,t,o,n,i){var s={isUpdate:!0};return"function"==typeof n?i=n:"string"==typeof n&&(s.tDescription=n),this.backend.create(this.options.referenceLng,e,t,o,i,s),this},used:function(e,t){V.used(e,t)}}}));

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).locizer=t()}(this,(function(){"use strict";var e=[],t=e.forEach,o=e.slice;function n(e){return t.call(o.call(arguments,1),(function(t){if(t)for(var o in t)void 0===e[o]&&(e[o]=t[o])})),e}function i(e,t,o){var n;return function(){var i=this,r=arguments,s=function(){n=null,o||e.apply(i,r)},a=o&&!n;clearTimeout(n),n=setTimeout(s,t),a&&e.apply(i,r)}}function r(e,t,o){function n(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}for(var i="string"!=typeof t?[].concat(t):t.split(".");i.length>1;){if(!e)return{};var r=n(i.shift());!e[r]&&o&&(e[r]=new o),e=e[r]}return e?{obj:e,k:n(i.shift())}:{}}function s(e,t,o){var n=r(e,t,Object);n.obj[n.k]=o}function a(e,t){var o=r(e,t),n=o.obj,i=o.k;if(n)return n[i]}var c,u=new RegExp("{{(.+?)}}","g");function l(e,t,o){var n,i,r;for(;n=u.exec(e);)"string"!=typeof(i=n[1].trim())&&(i=null==(r=i)?"":""+r),i||(i=""),i=i.replace(/\$/g,"$$$$"),e=e.replace(n[0],t[i]||i),u.lastIndex=0;return e}function d(e,t){return t.reduce((function(t,o){if(t)return t;if(!e||!e[o]||"string"!=typeof e[o]||!e[o].toLowerCase()===o.toLowerCase()){var n='i18next-locize-backend :: got "'.concat(e[o],'" in options for ').concat(o," which is invalid.");return console.warn(n),n}return!1}),!1)}if("function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?c=global.fetch:"undefined"!=typeof window&&window.fetch&&(c=window.fetch)),"undefined"!=typeof require&&("undefined"==typeof window||void 0===window.document)){var f=c||require("node-fetch");f.default&&(f=f.default),exports.default=f,module.exports=exports.default}var p,h,g,v=Object.freeze({__proto__:null});"function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?p=global.fetch:"undefined"!=typeof window&&window.fetch&&(p=window.fetch)),"function"==typeof XMLHttpRequest&&("undefined"!=typeof global&&global.XMLHttpRequest?h=global.XMLHttpRequest:"undefined"!=typeof window&&window.XMLHttpRequest&&(h=window.XMLHttpRequest)),"function"==typeof ActiveXObject&&("undefined"!=typeof global&&global.ActiveXObject?g=global.ActiveXObject:"undefined"!=typeof window&&window.ActiveXObject&&(g=window.ActiveXObject)),p||!v||h||g||(p=v),"function"!=typeof p&&(p=void 0);var w=function(e,t,o,n){return"function"==typeof o&&(n=o,o=void 0),n=n||function(){},p?function(e,t,o,n){p(t,{method:o?"POST":"GET",body:o?JSON.stringify(o):void 0,headers:{Authorization:e.authorize&&e.apiKey?e.apiKey:void 0,"Content-Type":"application/json"}}).then((function(e){var t=e.headers&&"Error from cloudfront"===e.headers.get("x-cache");if(!e.ok)return n(e.statusText||"Error",{status:e.status,resourceNotExisting:t});e.text().then((function(o){n(null,{status:e.status,data:o,resourceNotExisting:t})})).catch(n)})).catch(n)}(e,t,o,n):"function"==typeof XMLHttpRequest||"function"==typeof ActiveXObject?function(e,t,o,n){try{var i;(i=h?new h:new g("MSXML2.XMLHTTP.3.0")).open(o?"POST":"GET",t,1),e.crossDomain||i.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.authorize&&e.apiKey&&i.setRequestHeader("Authorization",e.apiKey),(o||e.setContentTypeJSON)&&i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=function(){var e="Error from cloudfront"===i.getResponseHeader("x-cache");i.readyState>3&&n(i.status>=400?i.statusText:null,{status:i.status,data:i.responseText,resourceNotExisting:e})},i.send(JSON.stringify(o))}catch(e){console&&console.log(e)}}(e,t,o,n):void 0};function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var b,x=function(){return{loadPath:"https://api.locize.app/{{projectId}}/{{version}}/{{lng}}/{{ns}}",privatePath:"https://api.locize.app/private/{{projectId}}/{{version}}/{{lng}}/{{ns}}",getLanguagesPath:"https://api.locize.app/languages/{{projectId}}",addPath:"https://api.locize.app/missing/{{projectId}}/{{version}}/{{lng}}/{{ns}}",updatePath:"https://api.locize.app/update/{{projectId}}/{{version}}/{{lng}}/{{ns}}",referenceLng:"en",crossDomain:!0,setContentTypeJSON:!1,version:"latest",private:!1,translatedPercentageThreshold:.9,whitelistThreshold:.9,failLoadingOnEmptyJSON:!1,allowedAddOrUpdateHosts:["localhost"],onSaved:!1,reloadInterval:"undefined"==typeof window&&36e5,checkForProjectTimeout:3e3,storageExpiration:36e5}};try{b="undefined"!=typeof window&&null!==window.localStorage;var k="notExistingLocizeProject";window.localStorage.setItem(k,"foo"),window.localStorage.removeItem(k)}catch(e){b=!1}function j(e){var t=function(){},o=function(){};return b?(t=function(e){window.localStorage.setItem("notExistingLocizeProject_".concat(e),Date.now())},o=function(t){var o=window.localStorage.getItem("notExistingLocizeProject_".concat(t));return!!o&&(!(Date.now()-o>e)||(window.localStorage.removeItem("notExistingLocizeProject_".concat(t)),!1))}):"undefined"!=typeof document&&(t=function(t){var o=new Date;o.setTime(o.getTime()+e);var n="; expires=".concat(o.toGMTString()),i="notExistingLocizeProject_".concat(t);document.cookie="".concat(i,"=").concat(Date.now()).concat(n,";path=/")},o=function(e){for(var t="notExistingLocizeProject_".concat(e),o="".concat(t,"="),n=document.cookie.split(";"),i=0;i<n.length;i++){for(var r=n[i];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(o))return!0}return!1}),{setProjectNotExisting:t,isProjectNotExisting:o}}var E=function(){function e(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;y(this,e),this.services=t,this.options=o,this.allOptions=n,this.type="backend",t&&t.projectId?this.init(null,t,n,o):this.init(t,o,n,i)}var t,o,c;return t=e,(o=[{key:"init",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;this.services=e,void 0!==o.whitelistThreshold&&void 0===o.translatedPercentageThreshold&&(e&&e.logger&&e.logger.deprecate("whitelistThreshold",'option "whitelistThreshold" will be renamed to "translatedPercentageThreshold" in the next major - please make sure to rename this option asap.'),o.translatedPercentageThreshold=o.whitelistThreshold),this.options=n(o,this.options||{},x()),this.allOptions=r,this.somethingLoaded=!1,this.isProjectNotExisting=!1,this.storage=j(this.options.storageExpiration),this.options.pull&&console.warn('The pull API was removed use "private: true" option instead: https://docs.locize.com/integration/api#fetch-private-namespace-resources');var a="undefined"!=typeof window&&window.location&&window.location.hostname;a?(this.isAddOrUpdateAllowed="function"==typeof this.options.allowedAddOrUpdateHosts?this.options.allowedAddOrUpdateHosts(a):this.options.allowedAddOrUpdateHosts.indexOf(a)>-1,e&&e.logger&&(r.saveMissing||r.updateMissing)&&(this.isAddOrUpdateAllowed?"localhost"!==a&&e.logger.warn('locize-backend: you are using the save or update missings feature from this host "'.concat(a,'".\nMake sure you will not use it in production!\nhttps://docs.locize.com/guides-tips-and-tricks/going-production')):e.logger.warn("function"==typeof this.options.allowedAddOrUpdateHosts?'locize-backend: will not save or update missings because allowedAddOrUpdateHosts returned false for the host "'.concat(a,'".'):'locize-backend: will not save or update missings because the host "'.concat(a,'" was not in the list of allowedAddOrUpdateHosts: ').concat(this.options.allowedAddOrUpdateHosts.join(", ")," (matches need to be exact).")))):this.isAddOrUpdateAllowed=!0,"function"==typeof s&&this.getOptions((function(e,n){if(e)return s(e);t.options.referenceLng=o.referenceLng||n.referenceLng||t.options.referenceLng,s(null,n)})),this.queuedWrites={pending:{}},this.debouncedProcess=i(this.process,1e4),this.interval&&clearInterval(this.interval),this.options.reloadInterval&&this.options.projectId&&(this.interval=setInterval((function(){return t.reload()}),this.options.reloadInterval))}},{key:"reload",value:function(){var e=this,t=this.services,o=t.backendConnector,n=t.languageUtils,i=t.logger;if(o){var r=o.language;if(!r||"cimode"!==r.toLowerCase()){var s=[],a=function(e){n.toResolveHierarchy(e).forEach((function(e){s.indexOf(e)<0&&s.push(e)}))};a(r),this.allOptions.preload&&this.allOptions.preload.forEach((function(e){return a(e)})),s.forEach((function(t){e.allOptions.ns.forEach((function(e){o.read(t,e,"read",null,null,(function(n,r){n&&i.warn("loading namespace ".concat(e," for language ").concat(t," failed"),n),!n&&r&&i.log("loaded namespace ".concat(e," for language ").concat(t),r),o.loaded("".concat(t,"|").concat(e),n,r)}))}))}))}}}},{key:"getLanguages",value:function(e){var t=this,o=d(this.options,["projectId"]);if(o)return e(new Error(o));var n=l(this.options.getLanguagesPath,{projectId:this.options.projectId});if(!this.isProjectNotExisting&&this.storage.isProjectNotExisting(this.options.projectId)&&(this.isProjectNotExisting=!0),this.isProjectNotExisting)return e(new Error("locize project ".concat(this.options.projectId," does not exist!")));this.loadUrl({},n,(function(o,n,i){if(!t.somethingLoaded&&i&&i.resourceNotExisting)return t.isProjectNotExisting=!0,t.storage.setProjectNotExisting(t.options.projectId),e(new Error("locize project ".concat(t.options.projectId," does not exist!")));t.somethingLoaded=!0,e(o,n)}))}},{key:"getOptions",value:function(e){var t=this;this.getLanguages((function(o,n){if(o)return e(o);var i=Object.keys(n);if(!i.length)return e(new Error("was unable to load languages via API"));var r=i.reduce((function(e,t){return n[t].isReferenceLanguage&&(e=t),e}),""),s=i.reduce((function(e,o){var i=n[o];return i.translated[t.options.version]&&i.translated[t.options.version]>=t.options.translatedPercentageThreshold&&e.push(o),e}),[]),a=i.reduce((function(e,t){return t.indexOf("-")>-1||e}),!1);e(null,{fallbackLng:r,referenceLng:r,supportedLngs:s,whitelist:s,load:a?"all":"languageOnly"})}))}},{key:"checkIfProjectExists",value:function(e){var t=this,o=this.services.logger;this.somethingLoaded?e&&e(null):this.alreadyRequestedCheckIfProjectExists?setTimeout((function(){return t.checkIfProjectExists(e)}),this.options.checkForProjectTimeout):(this.alreadyRequestedCheckIfProjectExists=!0,this.getLanguages((function(t){t&&t.message&&t.message.indexOf("does not exist")>0&&o&&o.error(t.message),e&&e(t)})))}},{key:"read",value:function(e,t,o){var n,i=this,r=(this.services||{logger:console}).logger,s={};if(this.options.private){var a=d(this.options,["projectId","version","apiKey"]);if(a)return o(new Error(a),!1);n=l(this.options.privatePath,{lng:e,ns:t,projectId:this.options.projectId,version:this.options.version}),s={authorize:!0}}else{var c=d(this.options,["projectId","version"]);if(c)return o(new Error(c),!1);n=l(this.options.loadPath,{lng:e,ns:t,projectId:this.options.projectId,version:this.options.version})}if(!this.isProjectNotExisting&&this.storage.isProjectNotExisting(this.options.projectId)&&(this.isProjectNotExisting=!0),this.isProjectNotExisting){var u=new Error("locize project ".concat(this.options.projectId," does not exist!"));return r&&r.error(u.message),void(o&&o(u))}this.loadUrl(s,n,(function(e,t,n){i.somethingLoaded||(n&&n.resourceNotExisting?setTimeout((function(){return i.checkIfProjectExists()}),i.options.checkForProjectTimeout):i.somethingLoaded=!0),o(e,t)}))}},{key:"loadUrl",value:function(e,t,o,i){var r=this;e=n(e,this.options),"function"==typeof o&&(i=o,o=void 0),i=i||function(){},w(e,t,o,(function(e,o){var n,s,a=o&&o.resourceNotExisting;if(o&&(408===o.status||400===o.status))return i("failed loading "+t,!0,{resourceNotExisting:a});if(o&&(o.status>=500&&o.status<600||!o.status))return i("failed loading "+t,!0,{resourceNotExisting:a});if(o&&o.status>=400&&o.status<500)return i("failed loading "+t,!1,{resourceNotExisting:a});if(!o&&e&&e.message&&e.message.indexOf("Failed to fetch")>-1)return i("failed loading "+t,!0,{resourceNotExisting:a});if(e)return i(e,!1);try{n=JSON.parse(o.data)}catch(e){s="failed parsing "+t+" to json"}return s?i(s,!1):r.options.failLoadingOnEmptyJSON&&!Object.keys(n).length?i("loaded result empty for "+t,!1,{resourceNotExisting:a}):void i(null,n,{resourceNotExisting:a})}))}},{key:"create",value:function(e,t,o,n,i,r){var s=this;i||(i=function(){}),this.checkIfProjectExists((function(a){if(a)return i(a);var c=d(s.options,["projectId","version","apiKey","referenceLng"]);return c?i(new Error(c)):s.isAddOrUpdateAllowed?("string"==typeof e&&(e=[e]),e.filter((function(e){return e===s.options.referenceLng})).length<1&&s.services&&s.services.logger&&s.services.logger.warn('locize-backend: will not save missings because the reference language "'.concat(s.options.referenceLng,'" was not in the list of to save languages: ').concat(e.join(", ")," (open your site in the reference language to save missings).")),void e.forEach((function(e){e===s.options.referenceLng&&s.queue.call(s,s.options.referenceLng,t,o,n,i,r)}))):i("host is not allowed to create key.")}))}},{key:"update",value:function(e,t,o,n,i,r){var s=this;i||(i=function(){}),this.checkIfProjectExists((function(a){if(a)return i(a);var c=d(s.options,["projectId","version","apiKey","referenceLng"]);return c?i(new Error(c)):s.isAddOrUpdateAllowed?(r||(r={}),"string"==typeof e&&(e=[e]),r.isUpdate=!0,void e.forEach((function(e){e===s.options.referenceLng&&s.queue.call(s,s.options.referenceLng,t,o,n,i,r)}))):i("host is not allowed to update key.")}))}},{key:"writePage",value:function(e,t,o,i){var r=l(this.options.addPath,{lng:e,ns:t,projectId:this.options.projectId,version:this.options.version}),s=l(this.options.updatePath,{lng:e,ns:t,projectId:this.options.projectId,version:this.options.version}),a=!1,c=!1,u={},d={};o.forEach((function(e){var t=e.options&&e.options.tDescription?{value:e.fallbackValue||"",context:{text:e.options.tDescription}}:e.fallbackValue||"";e.options&&e.options.isUpdate?(c||(c=!0),d[e.key]=t):(a||(a=!0),u[e.key]=t)}));var f=0;a&&f++,c&&f++;var p=function(e){--f||i(e)};f||p(),a&&w(n({authorize:!0},this.options),r,u,p),c&&w(n({authorize:!0},this.options),s,d,p)}},{key:"write",value:function(e,t){var o=this;if(!a(this.queuedWrites,["locks",e,t])){var n=a(this.queuedWrites,[e,t]);s(this.queuedWrites,[e,t],[]),n.length&&function(){s(o.queuedWrites,["locks",e,t],!0);var i=function(){s(o.queuedWrites,["locks",e,t],!1),n.forEach((function(e){e.callback&&e.callback()})),o.options.onSaved&&o.options.onSaved(e,t),o.debouncedProcess(e,t)},r=n.length/1e3,a=0,c=n.splice(0,1e3);for(o.writePage(e,t,c,(function(){++a>=r&&i()}));1e3===c.length;)(c=n.splice(0,1e3)).length&&o.writePage(e,t,c,(function(){++a>=r&&i()}))}()}}},{key:"process",value:function(){var e=this;Object.keys(this.queuedWrites).forEach((function(t){"locks"!==t&&Object.keys(e.queuedWrites[t]).forEach((function(o){e.queuedWrites[t][o].length&&e.write(t,o)}))}))}},{key:"queue",value:function(e,t,o,n,i,s){!function(e,t,o,n){var i=r(e,t,Object),s=i.obj,a=i.k;s[a]=s[a]||[],n&&(s[a]=s[a].concat(o)),n||s[a].push(o)}(this.queuedWrites,[e,t],{key:o,fallbackValue:n||"",callback:i,options:s}),this.debouncedProcess()}}])&&m(t.prototype,o),c&&m(t,c),e}();function L(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}E.type="backend";var S=[],I=S.forEach,P=S.slice;function T(e){return I.call(P.call(arguments,1),(function(t){if(t)for(var o in t)void 0===e[o]&&(e[o]=t[o])})),e}var N=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,A=function(e,t,o){var n=o||{};n.path=n.path||"/";var i=e+"="+encodeURIComponent(t);if(n.maxAge>0){var r=n.maxAge-0;if(isNaN(r))throw new Error("maxAge should be a Number");i+="; Max-Age="+Math.floor(r)}if(n.domain){if(!N.test(n.domain))throw new TypeError("option domain is invalid");i+="; Domain="+n.domain}if(n.path){if(!N.test(n.path))throw new TypeError("option path is invalid");i+="; Path="+n.path}if(n.expires){if("function"!=typeof n.expires.toUTCString)throw new TypeError("option expires is invalid");i+="; Expires="+n.expires.toUTCString()}if(n.httpOnly&&(i+="; HttpOnly"),n.secure&&(i+="; Secure"),n.sameSite)switch("string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return i},q=function(e,t,o,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/",sameSite:"strict"};o&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+60*o*1e3)),n&&(i.domain=n),document.cookie=A(e,encodeURIComponent(t),i)},z=function(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var i=o[n];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null},H={name:"cookie",lookup:function(e){var t;if(e.lookupCookie&&"undefined"!=typeof document){var o=z(e.lookupCookie);o&&(t=o)}return t},cacheUserLanguage:function(e,t){t.lookupCookie&&"undefined"!=typeof document&&q(t.lookupCookie,e,t.cookieMinutes,t.cookieDomain,t.cookieOptions)}},U={name:"querystring",lookup:function(e){var t;if("undefined"!=typeof window)for(var o=window.location.search.substring(1).split("&"),n=0;n<o.length;n++){var i=o[n].indexOf("=");if(i>0)o[n].substring(0,i)===e.lookupQuerystring&&(t=o[n].substring(i+1))}return t}},R=null,C=function(){if(null!==R)return R;try{R="undefined"!==window&&null!==window.localStorage;window.localStorage.setItem("i18next.translate.boo","foo"),window.localStorage.removeItem("i18next.translate.boo")}catch(e){R=!1}return R},X={name:"localStorage",lookup:function(e){var t;if(e.lookupLocalStorage&&C()){var o=window.localStorage.getItem(e.lookupLocalStorage);o&&(t=o)}return t},cacheUserLanguage:function(e,t){t.lookupLocalStorage&&C()&&window.localStorage.setItem(t.lookupLocalStorage,e)}},M=null,D=function(){if(null!==M)return M;try{M="undefined"!==window&&null!==window.sessionStorage;window.sessionStorage.setItem("i18next.translate.boo","foo"),window.sessionStorage.removeItem("i18next.translate.boo")}catch(e){M=!1}return M},F={name:"sessionStorage",lookup:function(e){var t;if(e.lookupSessionStorage&&D()){var o=window.sessionStorage.getItem(e.lookupSessionStorage);o&&(t=o)}return t},cacheUserLanguage:function(e,t){t.lookupSessionStorage&&D()&&window.sessionStorage.setItem(t.lookupSessionStorage,e)}},_={name:"navigator",lookup:function(e){var t=[];if("undefined"!=typeof navigator){if(navigator.languages)for(var o=0;o<navigator.languages.length;o++)t.push(navigator.languages[o]);navigator.userLanguage&&t.push(navigator.userLanguage),navigator.language&&t.push(navigator.language)}return t.length>0?t:void 0}},K={name:"htmlTag",lookup:function(e){var t,o=e.htmlTag||("undefined"!=typeof document?document.documentElement:null);return o&&"function"==typeof o.getAttribute&&(t=o.getAttribute("lang")),t}},W={name:"path",lookup:function(e){var t;if("undefined"!=typeof window){var o=window.location.pathname.match(/\/([a-zA-Z-]*)/g);if(o instanceof Array)if("number"==typeof e.lookupFromPathIndex){if("string"!=typeof o[e.lookupFromPathIndex])return;t=o[e.lookupFromPathIndex].replace("/","")}else t=o[0].replace("/","")}return t}},J={name:"subdomain",lookup:function(e){var t;if("undefined"!=typeof window){var o=window.location.href.match(/(?:http[s]*\:\/\/)*(.*?)\.(?=[^\/]*\..{2,5})/gi);o instanceof Array&&(t="number"==typeof e.lookupFromSubdomainIndex?o[e.lookupFromSubdomainIndex].replace("http://","").replace("https://","").replace(".",""):o[0].replace("http://","").replace("https://","").replace(".",""))}return t}};var $=function(){function e(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};L(this,e),this.type="languageDetector",this.detectors={},this.init(t,o)}var t,o,n;return t=e,(o=[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e,this.options=T(t,this.options||{},{order:["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"],lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"]}),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=o,this.addDetector(H),this.addDetector(U),this.addDetector(X),this.addDetector(F),this.addDetector(_),this.addDetector(K),this.addDetector(W),this.addDetector(J)}},{key:"addDetector",value:function(e){this.detectors[e.name]=e}},{key:"detect",value:function(e){var t=this;e||(e=this.options.order);var o=[];return e.forEach((function(e){if(t.detectors[e]){var n=t.detectors[e].lookup(t.options);n&&"string"==typeof n&&(n=[n]),n&&(o=o.concat(n))}})),this.services.languageUtils.getBestMatchFromCodes?o:o.length>0?o[0]:null}},{key:"cacheUserLanguage",value:function(e,t){var o=this;t||(t=this.options.caches),t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach((function(t){o.detectors[t]&&o.detectors[t].cacheUserLanguage(e,o.options)})))}}])&&O(t.prototype,o),n&&O(t,n),e}();$.type="languageDetector";var G,V=[],B=V.forEach,Q=V.slice;function Z(e){return B.call(Q.call(arguments,1),(function(t){if(t)for(var o in t)void 0===e[o]&&(e[o]=t[o])})),e}if("function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?G=global.fetch:"undefined"!=typeof window&&window.fetch&&(G=window.fetch)),"undefined"!=typeof require&&("undefined"==typeof window||void 0===window.document)){var Y=G||require("node-fetch");Y.default&&(Y=Y.default),exports.default=Y,module.exports=exports.default}var ee,te,oe,ne=Object.freeze({__proto__:null});"function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?ee=global.fetch:"undefined"!=typeof window&&window.fetch&&(ee=window.fetch)),"function"==typeof XMLHttpRequest&&("undefined"!=typeof global&&global.XMLHttpRequest?te=global.XMLHttpRequest:"undefined"!=typeof window&&window.XMLHttpRequest&&(te=window.XMLHttpRequest)),"function"==typeof ActiveXObject&&("undefined"!=typeof global&&global.ActiveXObject?oe=global.ActiveXObject:"undefined"!=typeof window&&window.ActiveXObject&&(oe=window.ActiveXObject)),ee||!ne||te||oe||(ee=ne),"function"!=typeof ee&&(ee=void 0);var ie=function(e,t,o,n){return"function"==typeof o&&(n=o,o=void 0),n=n||function(){},ee?function(e,t,o,n){ee(t,{method:o?"POST":"GET",body:o?JSON.stringify(o):void 0,headers:{Authorization:e.authorize&&e.apiKey?e.apiKey:void 0,"Content-Type":"application/json"}}).then((function(e){var t=e.headers&&"Error from cloudfront"===e.headers.get("x-cache");if(!e.ok)return n(e.statusText||"Error",{status:e.status,resourceNotExisting:t});e.text().then((function(o){n(null,{status:e.status,data:o,resourceNotExisting:t})})).catch(n)})).catch(n)}(e,t,o,n):"function"==typeof XMLHttpRequest||"function"==typeof ActiveXObject?function(e,t,o,n){try{var i;(i=te?new te:new oe("MSXML2.XMLHTTP.3.0")).open(o?"POST":"GET",t,1),e.crossDomain||i.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.authorize&&e.apiKey&&i.setRequestHeader("Authorization",e.apiKey),(o||e.setContentTypeJSON)&&i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=function(){var e="Error from cloudfront"===i.getResponseHeader("x-cache");i.readyState>3&&n(i.status>=400?i.statusText:null,{status:i.status,data:i.responseText,resourceNotExisting:e})},i.send(JSON.stringify(o))}catch(e){console&&console.log(e)}}(e,t,o,n):void 0},re={init:function(e){var t=e.t&&"function"==typeof e.t;this.options=Z(t?e.options.locizeLastUsed:e,this.options||{},{lastUsedPath:"https://api.locize.app/used/{{projectId}}/{{version}}/{{lng}}/{{ns}}",referenceLng:"en",crossDomain:!0,setContentTypeJSON:!1,version:"latest",debounceSubmit:9e4,allowedHosts:["localhost"]});var o,n,i,r,s="undefined"!=typeof window&&window.location&&window.location.hostname;this.isAllowed=!s||this.options.allowedHosts.indexOf(s)>-1,this.submitting=null,this.pending={},this.done={},this.submit=(o=this.submit,n=this.options.debounceSubmit,function(){var e=this,t=arguments,s=function(){r=null,i||o.apply(e,t)},a=i&&!r;clearTimeout(r),r=setTimeout(s,n),a&&o.apply(e,t)}),t&&this.interceptI18next(e)},interceptI18next:function(e){var t=this,o=e.services.resourceStore.getResource;e.services.resourceStore.getResource=function(n,i,r,s){return r&&t.used(i,r),o.call(e.services.resourceStore,n,i,r,s)}},used:function(e,t,o){var n=this;["pending","done"].forEach((function(o){n.done[e]&&n.done[e][t]||(n[o][e]||(n[o][e]={}),n[o][e][t]=!0)})),this.submit(o)},submit:function(e){var t=this;if(!this.isAllowed)return e&&e(new Error("not allowed"));if(this.submitting)return this.submit(e);var o,n=(o=this.options,["projectId","version","apiKey","referenceLng"].reduce((function(e,t){if(e)return e;if(!o||!o[t]||"string"!=typeof o[t]||!o[t].toLowerCase()===t.toLowerCase()){var n='i18next-lastused :: got "'.concat(o[t],'" in options for ').concat(t," which is invalid.");return console.warn(n),n}return!1}),!1));if(n)return e&&e(new Error(n));this.submitting=this.pending,this.pending={};var i=Object.keys(this.submitting),r=i.length,s=function(o){--r||(t.submitting=null,e&&e(o))};i.forEach((function(e){var o=Object.keys(t.submitting[e]),n=function(e,t,o){var n=e;return t.forEach((function(e){var t=new RegExp("{{".concat(e,"}}"),"g");n=n.replace(t,o[e])})),n}(t.options.lastUsedPath,["projectId","version","lng","ns"],Z({lng:t.options.referenceLng,ns:e},t.options));o.length?ie(Z({authorize:!0},t.options),n,o,s):s()}))},type:"3rdParty"},se=new RegExp("{{(.+?)}}","g");function ae(e){if(e.indexOf("-")<0)return e;var t=e.split("-");return["NB-NO","NN-NO","nb-NO","nn-NO","nb-no","nn-no"].indexOf(e)>-1?t[1].toLowerCase():t[0]}var ce={interpolator:{interpolate:function(e,t,o){for(var n,i,r;n=se.exec(e);)"string"!=typeof(i=n[1].trim())&&(i=null==(r=i)?"":""+r),i||(i=""),i=i.replace(/\$/g,"$$$$"),e=e.replace(n[0],t[i]||i),se.lastIndex=0;return e}},languageUtils:{formatLanguageCode:function(e){return e}}};return{init:function(e){return this.options=e,this.backend=new E(ce,e),this.detector=new $(ce,e),this.lng=e.lng||this.detector.detect(),re.init(e),this},getLanguage:function(e,t){var o=this;"function"==typeof e&&(t=e,e=this.lng),e||(e=this.lng);var n=function(e,t){return e[t]&&e[t].translated[o.options.version||"latest"]>=(o.options.loadIfTranslatedOver||1)};return this.getLanguages((function(i,r){return n(r,e)?t(null,e):n(r,ae(e))?t(null,ae(e)):void t(null,o.options.fallbackLng||Object.keys(r)[0])})),this},getLanguages:function(e){var t=this;return this.publishedLngs?e(null,this.publishedLngs):this.backend.getLanguages((function(o,n){o||(t.publishedLngs=n),e(null,n)})),this},load:function(e,t,o){var n=this;return"function"==typeof t&&(o=t,t=null),this.getLanguage(t,(function(t,i){n.backend.read(i,e,(function(e,t){return o(e,t,i)}))})),this},add:function(e,t,o,n,i){var r={};return"function"==typeof n?i=n:"string"==typeof n&&(r.tDescription=n),this.backend.create(this.options.referenceLng,e,t,o,i,r),this},update:function(e,t,o,n,i){var r={isUpdate:!0};return"function"==typeof n?i=n:"string"==typeof n&&(r.tDescription=n),this.backend.create(this.options.referenceLng,e,t,o,i,r),this},used:function(e,t){re.used(e,t)}}}));

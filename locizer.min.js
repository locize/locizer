!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.locizer=e()}(this,function(){"use strict";function t(t,e,n){var o;return function(){var i=this,r=arguments,a=function(){o=null,n||t.apply(i,r)},u=n&&!o;clearTimeout(o),o=setTimeout(a,e),u&&t.apply(i,r)}}function e(t,e,n){function o(t){return t&&t.indexOf("###")>-1?t.replace(/###/g,"."):t}for(var i="string"!=typeof e?[].concat(e):e.split(".");i.length>1;){if(!t)return{};var r=o(i.shift());!t[r]&&n&&(t[r]=new n),t=t[r]}return t?{obj:t,k:o(i.shift())}:{}}function n(t,n,o){var i=e(t,n,Object),r=i.obj,a=i.k;r[a]=o}function o(t,n,o,i){var r=e(t,n,Object),a=r.obj,u=r.k;a[u]=a[u]||[],i&&(a[u]=a[u].concat(o)),i||a[u].push(o)}function i(t,n){var o=e(t,n),i=o.obj,r=o.k;if(i)return i[r]}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e,n,o,i){try{var r=new(XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");r.open(o?"POST":"GET",t,1),e.crossDomain||r.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.authorize&&e.apiKey&&r.setRequestHeader("Authorization",e.apiKey),r.setRequestHeader("Content-type","application/json"),r.onreadystatechange=function(){r.readyState>3&&n&&n(r.responseText,r)},r.send(JSON.stringify(o))}catch(t){window.console&&console.log(t)}}function u(){return{loadPath:"https://api.locize.io/{{projectId}}/{{version}}/{{lng}}/{{ns}}",getLanguagesPath:"https://api.locize.io/languages/{{projectId}}",addPath:"https://api.locize.io/missing/{{projectId}}/{{version}}/{{lng}}/{{ns}}",referenceLng:"en",crossDomain:!0,version:"latest"}}function s(t){return m.call(L.call(arguments,1),function(e){if(e)for(var n in e)void 0===t[n]&&(t[n]=e[n])}),t}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(){return{order:["querystring","cookie","localStorage","navigator","htmlTag"],lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",caches:["localStorage"]}}function f(t){return null==t?"":""+t}function g(t,e,n){function o(t){return t.replace(/\$/g,"$$$$")}for(var i=void 0,r=void 0;i=E.exec(t);)r=i[1].trim(),"string"!=typeof r&&(r=f(r)),r||(r=""),r=o(r),t=t.replace(i[0],e[r]||r),E.lastIndex=0;return t}function d(t){return t}function h(t){return!0}function p(t){if(t.indexOf("-")<0)return t;var e=["NB-NO","NN-NO","nb-NO","nn-NO","nb-no","nn-no"],n=t.split("-");return e.indexOf(t)>-1?n[1].toLowerCase():n[0]}var v=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},k=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),y=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e),this.init(t,n),this.type="backend"}return k(e,[{key:"init",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.services=e,this.options=v({},u(),this.options,n),this.queuedWrites={},this.debouncedWrite=t(this.write,1e4)}},{key:"getLanguages",value:function(t){var e=this.services.interpolator.interpolate(this.options.getLanguagesPath,{projectId:this.options.projectId});this.loadUrl(e,t)}},{key:"read",value:function(t,e,n){var o=this.services.interpolator.interpolate(this.options.loadPath,{lng:t,ns:e,projectId:this.options.projectId,version:this.options.version});this.loadUrl(o,n)}},{key:"loadUrl",value:function(t,e){a(t,this.options,function(n,o){if(o.status>=500&&o.status<600)return e("failed loading "+t,!0);if(o.status>=400&&o.status<500)return e("failed loading "+t,!1);var i=void 0,r=void 0;try{i=JSON.parse(n)}catch(e){r="failed parsing "+t+" to json"}return r?e(r,!1):void e(null,i)})}},{key:"create",value:function(t,e,n,o,i){var r=this;i||(i=function(){}),"string"==typeof t&&(t=[t]),t.forEach(function(t){t===r.options.referenceLng&&r.queue.call(r,r.options.referenceLng,e,n,o,i)})}},{key:"write",value:function(t,e){var o=this,r=i(this.queuedWrites,["locks",t,e]);if(!r){var u=this.services.interpolator.interpolate(this.options.addPath,{lng:t,ns:e,projectId:this.options.projectId,version:this.options.version}),s=i(this.queuedWrites,[t,e]);n(this.queuedWrites,[t,e],[]),s.length&&!function(){n(o.queuedWrites,["locks",t,e],!0);var i={};s.forEach(function(t){i[t.key]=t.fallbackValue||""}),a(u,v({authorize:!0},o.options),function(i,r){n(o.queuedWrites,["locks",t,e],!1),s.forEach(function(t){t.callback&&t.callback()}),o.debouncedWrite(t,e)},i)}()}}},{key:"queue",value:function(t,e,n,i,r){o(this.queuedWrites,[t,e],{key:n,fallbackValue:i||"",callback:r}),this.debouncedWrite(t,e)}}]),e}();y.type="backend";var b=[],m=b.forEach,L=b.slice,w={create:function(t,e,n,o){var i=void 0;if(n){var r=new Date;r.setTime(r.getTime()+60*n*1e3),i="; expires="+r.toGMTString()}else i="";o=o?"domain="+o+";":"",document.cookie=t+"="+e+i+";"+o+"path=/"},read:function(t){for(var e=t+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var i=n[o];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(e))return i.substring(e.length,i.length)}return null},remove:function(t){this.create(t,"",-1)}},j={name:"cookie",lookup:function(t){var e=void 0;if(t.lookupCookie&&"undefined"!=typeof document){var n=w.read(t.lookupCookie);n&&(e=n)}return e},cacheUserLanguage:function(t,e){e.lookupCookie&&"undefined"!=typeof document&&w.create(e.lookupCookie,t,e.cookieMinutes,e.cookieDomain)}},O={name:"querystring",lookup:function(t){var e=void 0;if("undefined"!=typeof window)for(var n=window.location.search.substring(1),o=n.split("&"),i=0;i<o.length;i++){var r=o[i].indexOf("=");if(r>0){var a=o[i].substring(0,r);a===t.lookupQuerystring&&(e=o[i].substring(r+1))}}return e}},S=void 0;try{S="undefined"!==window&&null!==window.localStorage;var q="i18next.translate.boo";window.localStorage.setItem(q,"foo"),window.localStorage.removeItem(q)}catch(t){S=!1}var T={name:"localStorage",lookup:function(t){var e=void 0;if(t.lookupLocalStorage&&S){var n=window.localStorage.getItem(t.lookupLocalStorage);n&&(e=n)}return e},cacheUserLanguage:function(t,e){e.lookupLocalStorage&&S&&window.localStorage.setItem(e.lookupLocalStorage,t)}},x={name:"navigator",lookup:function(t){var e=[];if("undefined"!=typeof navigator){if(navigator.languages)for(var n=0;n<navigator.languages.length;n++)e.push(navigator.languages[n]);navigator.userLanguage&&e.push(navigator.userLanguage),navigator.language&&e.push(navigator.language)}return e.length>0?e:void 0}},I={name:"htmlTag",lookup:function(t){var e=void 0,n=t.htmlTag||("undefined"!=typeof document?document.documentElement:null);return n&&"function"==typeof n.getAttribute&&(e=n.getAttribute("lang")),e}},W=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),D=function(){function t(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];c(this,t),this.type="languageDetector",this.detectors={},this.init(e,n)}return W(t,[{key:"init",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];this.services=t,this.options=s(e,this.options||{},l()),this.i18nOptions=n,this.addDetector(j),this.addDetector(O),this.addDetector(T),this.addDetector(x),this.addDetector(I)}},{key:"addDetector",value:function(t){this.detectors[t.name]=t}},{key:"detect",value:function(t){var e=this;t||(t=this.options.order);var n=[];t.forEach(function(t){if(e.detectors[t]){var o=e.detectors[t].lookup(e.options);o&&"string"==typeof o&&(o=[o]),o&&(n=n.concat(o))}});var o=void 0;return n.forEach(function(t){if(!o){var n=e.services.languageUtils.formatLanguageCode(t);e.services.languageUtils.isWhitelisted(n)&&(o=n)}}),o||this.i18nOptions.fallbackLng[0]}},{key:"cacheUserLanguage",value:function(t,e){var n=this;e||(e=this.options.caches),e&&e.forEach(function(e){n.detectors[e]&&n.detectors[e].cacheUserLanguage(t,n.options)})}}]),t}();D.type="languageDetector";var E=new RegExp("{{(.+?)}}","g"),C={interpolator:{interpolate:g},languageUtils:{formatLanguageCode:d,isWhitelisted:h}},P={init:function(t){return this.options=t,this.backend=new y(C,t),this.detector=new D(C,t),this.lng=t.lng||this.detector.detect(),this},getLanguage:function(t,e){var n=this;"function"==typeof t&&(e=t,t=this.lng),t||(t=this.lng);var o=function(t,e){return t[e]&&t[e].translated[n.options.version||"latest"]>=(n.options.loadIfTranslatedOver||1)};return this.getLanguages(function(i,r){return o(r,t)?e(null,t):o(r,p(t))?e(null,p(t)):void e(null,n.options.fallbackLng||Object.keys(r)[0])}),this},getLanguages:function(t){var e=this;return this.publishedLngs&&t(null,this.publishedLngs),this.backend.getLanguages(function(n,o){n||(e.publishedLngs=o),t(null,o)}),this},load:function(t,e,n){var o=this;return"function"==typeof e&&(n=e,e=null),this.getLanguage(e,function(e,i){o.backend.read(i,t,n)}),this},add:function(t,e,n,o){return this.backend.create(this.options.referenceLng,t,e,n,o),this}};return P});
